<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="VAST Pipeline platform to enable processing of astronomical sources extracted from the ASKAP telescope for radio transient detection science"><meta name=author content="VAST Development Team"><link href=https://vast-survey.org/vast-pipeline/dev/reference/pipeline/utils/ rel=canonical><link rel=icon href=../../../img/favicon.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-8.2.8"><title>utils.py - VAST Pipeline</title><link rel=stylesheet href=../../../assets/stylesheets/main.644de097.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.e6a45f82.min.css><link rel=stylesheet href=../../../css/lightgallery.min.css><script src=../../../js/lightgallery.min.js></script><script src=../../../js/lg-zoom.js></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../theme/css/extra.css><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="VAST Pipeline - utils.py"><meta property=og:description content="VAST Pipeline platform to enable processing of astronomical sources extracted from the ASKAP telescope for radio transient detection science"><meta content=https://vast-survey.org/vast-pipeline/dev/reference/pipeline/utils/ property=og:url></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#vast_pipeline.pipeline.utils class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <style>
      .md-banner a,
      .md-banner a:focus,
      .md-banner a:hover{color:currentColor}.md-banner
      strong{white-space:nowrap}.md-banner}
  </style> <a href=../../../changelog/ > <strong> Development Version üßë‚Äçüíª: </strong> Check the <strong>release notes </strong> for the latest changes! </a> </div> </aside> </div> <div data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're viewing an outdated or development version. <a href=../../../..> <strong>Click here to go to latest stable release.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="VAST Pipeline" class="md-header__button md-logo" aria-label="VAST Pipeline" data-md-component=logo> <img src=../../../img/vast-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VAST Pipeline </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> utils.py </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary data-md-color-accent=blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/askap-vast/vast-pipeline title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> askap-vast/vast-pipeline </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../gettingstarted/installation/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../using/requireddata/ class=md-tabs__link> Using the Pipeline </a> </li> <li class=md-tabs__item> <a href=../../../design/overview/ class=md-tabs__link> Features & Design </a> </li> <li class=md-tabs__item> <a href=../../../developing/intro/ class=md-tabs__link> Contributing and Developing </a> </li> <li class=md-tabs__item> <a href=../../../faq/ class=md-tabs__link> FAQ </a> </li> <li class=md-tabs__item> <a href=../../../help_and_acknowledgements/ class=md-tabs__link> Help and Acknowledgements </a> </li> <li class=md-tabs__item> <a href=../../../changelog/ class="md-tabs__link md-tabs__link--active"> Reference </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="VAST Pipeline" class="md-nav__button md-logo" aria-label="VAST Pipeline" data-md-component=logo> <img src=../../../img/vast-logo.png alt=logo> </a> VAST Pipeline </label> <div class=md-nav__source> <a href=https://github.com/askap-vast/vast-pipeline title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> askap-vast/vast-pipeline </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../gettingstarted/installation/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../gettingstarted/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../../gettingstarted/deployment/ class=md-nav__link> Deployment </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Using the Pipeline <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Using the Pipeline" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Using the Pipeline </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../using/requireddata/ class=md-nav__link> Required Data </a> </li> <li class=md-nav__item> <a href=../../../using/access/ class=md-nav__link> Accessing the Pipeline </a> </li> <li class=md-nav__item> <a href=../../../using/initrun/ class=md-nav__link> Initialising a Run </a> </li> <li class=md-nav__item> <a href=../../../using/runconfig/ class=md-nav__link> Run Configuration </a> </li> <li class=md-nav__item> <a href=../../../using/processrun/ class=md-nav__link> Processing a Run </a> </li> <li class=md-nav__item> <a href=../../../using/addtorun/ class=md-nav__link> Adding Images to a Run </a> </li> <li class=md-nav__item> <a href=../../../using/restorerun/ class=md-nav__link> Restoring a Run </a> </li> <li class=md-nav__item> <a href=../../../using/deleterun/ class=md-nav__link> Deleting a Run </a> </li> <li class=md-nav__item> <a href=../../../using/genarrow/ class=md-nav__link> Generating Arrow Files </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_10 type=checkbox id=__nav_3_10> <label class=md-nav__link for=__nav_3_10> Exploring the Pipeline Website <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Exploring the Pipeline Website" data-md-level=2> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Exploring the Pipeline Website </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../exploringwebsite/websiteoverview/ class=md-nav__link> Website Overview </a> </li> <li class=md-nav__item> <a href=../../../exploringwebsite/datatables/ class=md-nav__link> DataTables </a> </li> <li class=md-nav__item> <a href=../../../exploringwebsite/runpages/ class=md-nav__link> Pipeline Run Pages </a> </li> <li class=md-nav__item> <a href=../../../exploringwebsite/sourcequery/ class=md-nav__link> Source Query </a> </li> <li class=md-nav__item> <a href=../../../exploringwebsite/sourceanalysis/ class=md-nav__link> Source Œ∑-V Analysis </a> </li> <li class=md-nav__item> <a href=../../../exploringwebsite/sourcedetail/ class=md-nav__link> Source Detail </a> </li> <li class=md-nav__item> <a href=../../../exploringwebsite/sourcetagsfavs/ class=md-nav__link> Source Tags & Favourites </a> </li> <li class=md-nav__item> <a href=../../../exploringwebsite/measurementdetail/ class=md-nav__link> Measurement Detail Page </a> </li> <li class=md-nav__item> <a href=../../../exploringwebsite/imagepages/ class=md-nav__link> Image Pages </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_11 type=checkbox id=__nav_3_11> <label class=md-nav__link for=__nav_3_11> Pipeline Outputs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Pipeline Outputs" data-md-level=2> <label class=md-nav__title for=__nav_3_11> <span class="md-nav__icon md-icon"></span> Pipeline Outputs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../outputs/outputs/ class=md-nav__link> Outputs Overview </a> </li> <li class=md-nav__item> <a href=../../../outputs/usingoutputs/ class=md-nav__link> Using the Outputs </a> </li> <li class=md-nav__item> <a href=../../../outputs/coldesc/ class=md-nav__link> Column Descriptions </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_12 type=checkbox id=__nav_3_12> <label class=md-nav__link for=__nav_3_12> Admin Usage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Admin Usage" data-md-level=2> <label class=md-nav__title for=__nav_3_12> <span class="md-nav__icon md-icon"></span> Admin Usage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../adminusage/cli/ class=md-nav__link> CLI </a> </li> <li class=md-nav__item> <a href=../../../adminusage/ingestimages/ class=md-nav__link> Standalone Image Ingestion </a> </li> <li class=md-nav__item> <a href=../../../adminusage/app/ class=md-nav__link> Web App </a> </li> <li class=md-nav__item> <a href=../../../exploringwebsite/admintools/ class=md-nav__link> Web App Admin Tools </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Features & Design <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Features & Design" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Features & Design </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../design/overview/ class=md-nav__link> Pipeline Steps Overview </a> </li> <li class=md-nav__item> <a href=../../../design/imageingest/ class=md-nav__link> Image & Selavy Catalogue Ingest </a> </li> <li class=md-nav__item> <a href=../../../design/association/ class=md-nav__link> Source Association </a> </li> <li class=md-nav__item> <a href=../../../design/newsources/ class=md-nav__link> New Sources </a> </li> <li class=md-nav__item> <a href=../../../design/monitor/ class=md-nav__link> Forced Measurements </a> </li> <li class=md-nav__item> <a href=../../../design/sourcestats/ class=md-nav__link> Source Statistics </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_7 type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7> Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Architecture data-md-level=2> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../architecture/intro/ class=md-nav__link> Architecture Overview </a> </li> <li class=md-nav__item> <a href=../../../architecture/database/ class=md-nav__link> Database Schema </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Contributing and Developing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Contributing and Developing" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Contributing and Developing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../developing/intro/ class=md-nav__link> Development Guidlines </a> </li> <li class=md-nav__item> <a href=../../../developing/github/ class=md-nav__link> GitHub Platform </a> </li> <li class=md-nav__item> <a href=../../../developing/localdevenv/ class=md-nav__link> Local Development Environment </a> </li> <li class=md-nav__item> <a href=../../../developing/tests/ class=md-nav__link> Tests </a> </li> <li class=md-nav__item> <a href=../../../developing/docsdev/ class=md-nav__link> Documentation </a> </li> <li class=md-nav__item> <a href=../../../developing/profiling/ class=md-nav__link> Benchmarks </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../../../help_and_acknowledgements/ class=md-nav__link> Help and Acknowledgements </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8 checked> <label class=md-nav__link for=__nav_8> Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Reference data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../changelog/ class=md-nav__link> Changelog </a> </li> <li class=md-nav__item> <a href=../../../code_of_conduct/ class=md-nav__link> Code of Conduct </a> </li> <li class=md-nav__item> <a href=../../../license/ class=md-nav__link> License </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_4 type=checkbox id=__nav_8_4 checked> <label class=md-nav__link for=__nav_8_4> Code Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Code Reference" data-md-level=2> <label class=md-nav__title for=__nav_8_4> <span class="md-nav__icon md-icon"></span> Code Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_4_1 type=checkbox id=__nav_8_4_1 checked> <label class=md-nav__link for=__nav_8_4_1> vast_pipeline <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=vast_pipeline data-md-level=3> <label class=md-nav__title for=__nav_8_4_1> <span class="md-nav__icon md-icon"></span> vast_pipeline </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_4_1_1 type=checkbox id=__nav_8_4_1_1> <label class=md-nav__link for=__nav_8_4_1_1> image <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=image data-md-level=4> <label class=md-nav__title for=__nav_8_4_1_1> <span class="md-nav__icon md-icon"></span> image </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../image/main/ class=md-nav__link> main.py </a> </li> <li class=md-nav__item> <a href=../../image/utils/ class=md-nav__link> utils.py </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_4_1_2 type=checkbox id=__nav_8_4_1_2> <label class=md-nav__link for=__nav_8_4_1_2> management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=management data-md-level=4> <label class=md-nav__title for=__nav_8_4_1_2> <span class="md-nav__icon md-icon"></span> management </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_4_1_2_1 type=checkbox id=__nav_8_4_1_2_1> <label class=md-nav__link for=__nav_8_4_1_2_1> commands <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=commands data-md-level=5> <label class=md-nav__title for=__nav_8_4_1_2_1> <span class="md-nav__icon md-icon"></span> commands </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../management/commands/clearpiperun/ class=md-nav__link> clearpiperun.py </a> </li> <li class=md-nav__item> <a href=../../management/commands/createmeasarrow/ class=md-nav__link> createmeasarrow.py </a> </li> <li class=md-nav__item> <a href=../../management/commands/debugrun/ class=md-nav__link> debugrun.py </a> </li> <li class=md-nav__item> <a href=../../management/commands/ingestimages/ class=md-nav__link> ingestimages.py </a> </li> <li class=md-nav__item> <a href=../../management/commands/initingest/ class=md-nav__link> initingest.py </a> </li> <li class=md-nav__item> <a href=../../management/commands/initpiperun/ class=md-nav__link> initpiperun.py </a> </li> <li class=md-nav__item> <a href=../../management/commands/restorepiperun/ class=md-nav__link> restorepiperun.py </a> </li> <li class=md-nav__item> <a href=../../management/commands/runpipeline/ class=md-nav__link> runpipeline.py </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../management/helpers/ class=md-nav__link> helpers.py </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_4_1_3 type=checkbox id=__nav_8_4_1_3 checked> <label class=md-nav__link for=__nav_8_4_1_3> pipeline <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=pipeline data-md-level=4> <label class=md-nav__title for=__nav_8_4_1_3> <span class="md-nav__icon md-icon"></span> pipeline </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../association/ class=md-nav__link> association.py </a> </li> <li class=md-nav__item> <a href=../config/ class=md-nav__link> config.py </a> </li> <li class=md-nav__item> <a href=../errors/ class=md-nav__link> errors.py </a> </li> <li class=md-nav__item> <a href=../finalise/ class=md-nav__link> finalise.py </a> </li> <li class=md-nav__item> <a href=../forced_extraction/ class=md-nav__link> forced_extraction.py </a> </li> <li class=md-nav__item> <a href=../loading/ class=md-nav__link> loading.py </a> </li> <li class=md-nav__item> <a href=../main/ class=md-nav__link> main.py </a> </li> <li class=md-nav__item> <a href=../model_generator/ class=md-nav__link> model_generator.py </a> </li> <li class=md-nav__item> <a href=../new_sources/ class=md-nav__link> new_sources.py </a> </li> <li class=md-nav__item> <a href=../pairs/ class=md-nav__link> pairs.py </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> utils.py <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> utils.py </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils class=md-nav__link> vast_pipeline.pipeline.utils </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils._get_skyregion_relations class=md-nav__link> _get_skyregion_relations() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils._load_measurements class=md-nav__link> _load_measurements() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.add_new_many_to_one_relations class=md-nav__link> add_new_many_to_one_relations() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.add_new_one_to_many_relations class=md-nav__link> add_new_one_to_many_relations() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.add_run_to_img class=md-nav__link> add_run_to_img() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.backup_parquets class=md-nav__link> backup_parquets() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.calc_ave_coord class=md-nav__link> calc_ave_coord() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.check_primary_image class=md-nav__link> check_primary_image() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.create_measurement_pairs_arrow_file class=md-nav__link> create_measurement_pairs_arrow_file() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.create_measurements_arrow_file class=md-nav__link> create_measurements_arrow_file() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.create_temp_config_file class=md-nav__link> create_temp_config_file() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.cross_join class=md-nav__link> cross_join() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_create_img class=md-nav__link> get_create_img() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_create_img_band class=md-nav__link> get_create_img_band() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_create_p_run class=md-nav__link> get_create_p_run() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_create_skyreg class=md-nav__link> get_create_skyreg() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_eta_metric class=md-nav__link> get_eta_metric() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_image_list_diff class=md-nav__link> get_image_list_diff() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_names_and_epochs class=md-nav__link> get_names_and_epochs() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_parallel_assoc_image_df class=md-nav__link> get_parallel_assoc_image_df() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_rms_noise_image_values class=md-nav__link> get_rms_noise_image_values() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_src_skyregion_merged_df class=md-nav__link> get_src_skyregion_merged_df() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.group_skyregions class=md-nav__link> group_skyregions() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.groupby_funcs class=md-nav__link> groupby_funcs() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.parallel_groupby class=md-nav__link> parallel_groupby() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.parallel_groupby_coord class=md-nav__link> parallel_groupby_coord() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.prep_skysrc_df class=md-nav__link> prep_skysrc_df() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.reconstruct_associtaion_dfs class=md-nav__link> reconstruct_associtaion_dfs() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.remove_duplicate_measurements class=md-nav__link> remove_duplicate_measurements() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.write_parquets class=md-nav__link> write_parquets() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_4_1_4 type=checkbox id=__nav_8_4_1_4> <label class=md-nav__link for=__nav_8_4_1_4> survey <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=survey data-md-level=4> <label class=md-nav__title for=__nav_8_4_1_4> <span class="md-nav__icon md-icon"></span> survey </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../survey/translators/ class=md-nav__link> translators.py </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_4_1_5 type=checkbox id=__nav_8_4_1_5> <label class=md-nav__link for=__nav_8_4_1_5> utils <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=utils data-md-level=4> <label class=md-nav__title for=__nav_8_4_1_5> <span class="md-nav__icon md-icon"></span> utils </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../utils/auth/ class=md-nav__link> auth.py </a> </li> <li class=md-nav__item> <a href=../../utils/external_query/ class=md-nav__link> external_query.py </a> </li> <li class=md-nav__item> <a href=../../utils/unit_tags/ class=md-nav__link> unit_tags.py </a> </li> <li class=md-nav__item> <a href=../../utils/utils/ class=md-nav__link> utils.py </a> </li> <li class=md-nav__item> <a href=../../utils/view/ class=md-nav__link> view.py </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../admin/ class=md-nav__link> admin.py </a> </li> <li class=md-nav__item> <a href=../../apps/ class=md-nav__link> apps.py </a> </li> <li class=md-nav__item> <a href=../../context_processors/ class=md-nav__link> context_processors.py </a> </li> <li class=md-nav__item> <a href=../../converters/ class=md-nav__link> converters.py </a> </li> <li class=md-nav__item> <a href=../../forms/ class=md-nav__link> forms.py </a> </li> <li class=md-nav__item> <a href=../../models/ class=md-nav__link> models.py </a> </li> <li class=md-nav__item> <a href=../../plots/ class=md-nav__link> plots.py </a> </li> <li class=md-nav__item> <a href=../../serializers/ class=md-nav__link> serializers.py </a> </li> <li class=md-nav__item> <a href=../../signals/ class=md-nav__link> signals.py </a> </li> <li class=md-nav__item> <a href=../../urls/ class=md-nav__link> urls.py </a> </li> <li class=md-nav__item> <a href=../../views/ class=md-nav__link> views.py </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils class=md-nav__link> vast_pipeline.pipeline.utils </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils._get_skyregion_relations class=md-nav__link> _get_skyregion_relations() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils._load_measurements class=md-nav__link> _load_measurements() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.add_new_many_to_one_relations class=md-nav__link> add_new_many_to_one_relations() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.add_new_one_to_many_relations class=md-nav__link> add_new_one_to_many_relations() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.add_run_to_img class=md-nav__link> add_run_to_img() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.backup_parquets class=md-nav__link> backup_parquets() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.calc_ave_coord class=md-nav__link> calc_ave_coord() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.check_primary_image class=md-nav__link> check_primary_image() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.create_measurement_pairs_arrow_file class=md-nav__link> create_measurement_pairs_arrow_file() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.create_measurements_arrow_file class=md-nav__link> create_measurements_arrow_file() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.create_temp_config_file class=md-nav__link> create_temp_config_file() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.cross_join class=md-nav__link> cross_join() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_create_img class=md-nav__link> get_create_img() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_create_img_band class=md-nav__link> get_create_img_band() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_create_p_run class=md-nav__link> get_create_p_run() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_create_skyreg class=md-nav__link> get_create_skyreg() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_eta_metric class=md-nav__link> get_eta_metric() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_image_list_diff class=md-nav__link> get_image_list_diff() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_names_and_epochs class=md-nav__link> get_names_and_epochs() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_parallel_assoc_image_df class=md-nav__link> get_parallel_assoc_image_df() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_rms_noise_image_values class=md-nav__link> get_rms_noise_image_values() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.get_src_skyregion_merged_df class=md-nav__link> get_src_skyregion_merged_df() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.group_skyregions class=md-nav__link> group_skyregions() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.groupby_funcs class=md-nav__link> groupby_funcs() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.parallel_groupby class=md-nav__link> parallel_groupby() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.parallel_groupby_coord class=md-nav__link> parallel_groupby_coord() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.prep_skysrc_df class=md-nav__link> prep_skysrc_df() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.reconstruct_associtaion_dfs class=md-nav__link> reconstruct_associtaion_dfs() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.remove_duplicate_measurements class=md-nav__link> remove_duplicate_measurements() </a> </li> <li class=md-nav__item> <a href=#vast_pipeline.pipeline.utils.write_parquets class=md-nav__link> write_parquets() </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/askap-vast/tree/dev/vast_pipeline/pipeline/utils.py title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>utils.py</h1> <div class="doc doc-object doc-module"> <a id=vast_pipeline.pipeline.utils></a> <div class="doc doc-contents first"> <p>This module contains utility functions that are used by the pipeline during the processing of a run.</p> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils._get_skyregion_relations class="doc doc-heading"> <code class="highlight language-python"><span class=n>_get_skyregion_relations</span><span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>coords</span><span class=p>,</span> <span class=n>ids</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils._get_skyregion_relations class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>For each sky region row a list is returned that contains the ids of other sky regions that overlap with the row sky region (including itself).</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>row</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code> </td> <td><p>A row from the dataframe containing all the sky regions of the run. Contains the 'id', 'centre_ra', 'centre_dec' and 'xtr_radius' columns.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>coords</code></td> <td> <code><span title="astropy.coordinates.SkyCoord">SkyCoord</span></code> </td> <td><p>A SkyCoord holding the coordinates of all sky regions.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>ids</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.core">core</span>.<span title="pd.core.indexes">indexes</span>.<span title="pd.core.indexes.numeric">numeric</span>.<span title="pd.core.indexes.numeric.Int64Index">Int64Index</span></code> </td> <td><p>The sky regions ids that match the coords.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="typing.List">List</span>[int]</code> </td> <td><p>A list of other sky regions (including self) that are within the 'xtr_radius' of the sky region in the row.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span>
<span class=normal>1096</span>
<span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span>
<span class=normal>1106</span>
<span class=normal>1107</span>
<span class=normal>1108</span>
<span class=normal>1109</span>
<span class=normal>1110</span>
<span class=normal>1111</span>
<span class=normal>1112</span>
<span class=normal>1113</span>
<span class=normal>1114</span>
<span class=normal>1115</span>
<span class=normal>1116</span>
<span class=normal>1117</span>
<span class=normal>1118</span>
<span class=normal>1119</span>
<span class=normal>1120</span>
<span class=normal>1121</span>
<span class=normal>1122</span>
<span class=normal>1123</span>
<span class=normal>1124</span>
<span class=normal>1125</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>_get_skyregion_relations</span><span class=p>(</span>
    <span class=n>row</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>,</span>
    <span class=n>coords</span><span class=p>:</span> <span class=n>SkyCoord</span><span class=p>,</span>
    <span class=n>ids</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>core</span><span class=o>.</span><span class=n>indexes</span><span class=o>.</span><span class=n>numeric</span><span class=o>.</span><span class=n>Int64Index</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]:</span>
    <span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    For each sky region row a list is returned that</span>
<span class=sd>    contains the ids of other sky regions that overlap</span>
<span class=sd>    with the row sky region (including itself).</span>

<span class=sd>    Args:</span>
<span class=sd>        row:</span>
<span class=sd>            A row from the dataframe containing all the sky regions of the run.</span>
<span class=sd>            Contains the &#39;id&#39;, &#39;centre_ra&#39;, &#39;centre_dec&#39; and &#39;xtr_radius&#39;</span>
<span class=sd>            columns.</span>
<span class=sd>        coords: A SkyCoord holding the coordinates of all sky regions.</span>
<span class=sd>        ids: The sky regions ids that match the coords.</span>

<span class=sd>    Returns:</span>
<span class=sd>        A list of other sky regions (including self) that are within the</span>
<span class=sd>            &#39;xtr_radius&#39; of the sky region in the row.</span>
<span class=sd>    &#39;&#39;&#39;</span>
    <span class=n>target</span> <span class=o>=</span> <span class=n>SkyCoord</span><span class=p>(</span>
        <span class=n>row</span><span class=p>[</span><span class=s1>&#39;centre_ra&#39;</span><span class=p>],</span>
        <span class=n>row</span><span class=p>[</span><span class=s1>&#39;centre_dec&#39;</span><span class=p>],</span>
        <span class=n>unit</span><span class=o>=</span><span class=p>(</span><span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>,</span> <span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=n>seps</span> <span class=o>=</span> <span class=n>target</span><span class=o>.</span><span class=n>separation</span><span class=p>(</span><span class=n>coords</span><span class=p>)</span>

    <span class=c1># place a slight buffer on the radius to make sure</span>
    <span class=c1># any neighbouring fields are caught</span>
    <span class=n>mask</span> <span class=o>=</span> <span class=n>seps</span> <span class=o>&lt;=</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;xtr_radius&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mf>1.1</span> <span class=o>*</span> <span class=n>u</span><span class=o>.</span><span class=n>deg</span>

    <span class=n>related_ids</span> <span class=o>=</span> <span class=n>ids</span><span class=p>[</span><span class=n>mask</span><span class=p>]</span><span class=o>.</span><span class=n>to_list</span><span class=p>()</span>

    <span class=k>return</span> <span class=n>related_ids</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils._load_measurements class="doc doc-heading"> <code class="highlight language-python"><span class=n>_load_measurements</span><span class=p>(</span><span class=n>image</span><span class=p>,</span> <span class=n>cols</span><span class=p>,</span> <span class=n>start_id</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>ini_df</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils._load_measurements class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Load the measurements for an image from the parquet file.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>image</code></td> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.models.Image" href="../../models/#vast_pipeline.models.Image">Image</a></code> </td> <td><p>The object representing the image for which to load the measurements.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>cols</code></td> <td> <code><span title="typing.List">List</span>[str]</code> </td> <td><p>The columns to load.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>start_id</code></td> <td> <code>int</code> </td> <td><p>The number to start from when setting the source ids (when 'ini_df' is 'True'). Defaults to 0.</p></td> <td> <code>0</code> </td> </tr> <tr> <td><code>ini_df</code></td> <td> <code>bool</code> </td> <td><p>Boolean to indicate whether these sources are part of the initial source list creation for association. If 'True' the source ids are reset ready for the first iteration. Defaults to 'False'.</p></td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The measurements of the image with some extra values set ready for association.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>_load_measurements</span><span class=p>(</span>
    <span class=n>image</span><span class=p>:</span> <span class=n>Image</span><span class=p>,</span>
    <span class=n>cols</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
    <span class=n>start_id</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
    <span class=n>ini_df</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Load the measurements for an image from the parquet file.</span>

<span class=sd>    Args:</span>
<span class=sd>        image:</span>
<span class=sd>            The object representing the image for which to load the</span>
<span class=sd>            measurements.</span>
<span class=sd>        cols:</span>
<span class=sd>            The columns to load.</span>
<span class=sd>        start_id:</span>
<span class=sd>            The number to start from when setting the source ids (when</span>
<span class=sd>            &#39;ini_df&#39; is &#39;True&#39;). Defaults to 0.</span>
<span class=sd>        ini_df:</span>
<span class=sd>            Boolean to indicate whether these sources are part of the initial</span>
<span class=sd>            source list creation for association. If &#39;True&#39; the source ids are</span>
<span class=sd>            reset ready for the first iteration. Defaults to &#39;False&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The measurements of the image with some extra values set ready for</span>
<span class=sd>            association.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>image_centre</span> <span class=o>=</span> <span class=n>SkyCoord</span><span class=p>(</span>
        <span class=n>image</span><span class=o>.</span><span class=n>ra</span><span class=p>,</span>
        <span class=n>image</span><span class=o>.</span><span class=n>dec</span><span class=p>,</span>
        <span class=n>unit</span><span class=o>=</span><span class=p>(</span><span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>,</span> <span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=n>image</span><span class=o>.</span><span class=n>measurements_path</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=n>cols</span><span class=p>)</span>
    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;image&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>name</span>
    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;datetime&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>datetime</span>
    <span class=c1># these are the first &#39;sources&#39; if ini_df is True.</span>
    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>index</span> <span class=o>+</span> <span class=n>start_id</span> <span class=o>+</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>ini_df</span> <span class=k>else</span> <span class=o>-</span><span class=mi>1</span>
    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;ra_source&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;ra&#39;</span><span class=p>]</span>
    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;dec_source&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;dec&#39;</span><span class=p>]</span>
    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;d2d&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mf>0.</span>
    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;dr&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mf>0.</span>
    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;related&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=n>sources_sc</span> <span class=o>=</span> <span class=n>SkyCoord</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;ra&#39;</span><span class=p>],</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;dec&#39;</span><span class=p>],</span> <span class=n>unit</span><span class=o>=</span><span class=p>(</span><span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>,</span> <span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>))</span>

    <span class=n>seps</span> <span class=o>=</span> <span class=n>sources_sc</span><span class=o>.</span><span class=n>separation</span><span class=p>(</span><span class=n>image_centre</span><span class=p>)</span><span class=o>.</span><span class=n>degree</span>
    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;dist_from_centre&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>seps</span>

    <span class=k>del</span> <span class=n>sources_sc</span>
    <span class=k>del</span> <span class=n>seps</span>

    <span class=k>return</span> <span class=n>df</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.add_new_many_to_one_relations class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_new_many_to_one_relations</span><span class=p>(</span><span class=n>row</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.add_new_many_to_one_relations class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>This handles the relation information being created from the many_to_one function in advanced association. It is a lot simpler than the one_to_many case as it purely just adds the new relations to the relation column, taking into account if it is already a list of relations or not (i.e. no previous relations).</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>row</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code> </td> <td><p>The relation information Series from the association dataframe. Only the columns ['related_skyc1', 'new_relations'] are required.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="typing.List">List</span>[int]</code> </td> <td><p>The new related field for the source in question, containing the appended ids.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>add_new_many_to_one_relations</span><span class=p>(</span><span class=n>row</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    This handles the relation information being created from the</span>
<span class=sd>    many_to_one function in advanced association.</span>
<span class=sd>    It is a lot simpler than the one_to_many case as it purely just adds</span>
<span class=sd>    the new relations to the relation column, taking into account if it is</span>
<span class=sd>    already a list of relations or not (i.e. no previous relations).</span>

<span class=sd>    Args:</span>
<span class=sd>        row:</span>
<span class=sd>            The relation information Series from the association dataframe.</span>
<span class=sd>            Only the columns [&#39;related_skyc1&#39;, &#39;new_relations&#39;] are required.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The new related field for the source in question, containing the</span>
<span class=sd>            appended ids.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>out</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;new_relations&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;related_skyc1&#39;</span><span class=p>],</span> <span class=nb>list</span><span class=p>):</span>
        <span class=n>out</span> <span class=o>+=</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;related_skyc1&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

    <span class=k>return</span> <span class=n>out</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.add_new_one_to_many_relations class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_new_one_to_many_relations</span><span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>advanced</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>source_ids</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.add_new_one_to_many_relations class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>This handles the relation information being created from the one_to_many functions in association.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>row</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code> </td> <td><p>The relation information Series from the association dataframe. Only the columns ['related_skyc1', 'source_skyc1'] are required for advanced, these are instead called ['related', 'source'] for basic.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>advanced</code></td> <td> <code>bool</code> </td> <td><p>Whether advanced association is being used which changes the names of the columns involved.</p></td> <td> <code>False</code> </td> </tr> <tr> <td><code>source_ids</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td><p>A dataframe that contains the other ids to append to related for each original source. +----------------+--------+ | source_skyc1 | 0 | |----------------+--------| | 122 | [5542] | | 254 | [5543] | | 262 | [5544] | | 405 | [5545] | | 656 | [5546] | +----------------+--------+</p></td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="typing.List">List</span>[int]</code> </td> <td><p>The new related field for the source in question, containing the appended ids.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>add_new_one_to_many_relations</span><span class=p>(</span>
    <span class=n>row</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>,</span> <span class=n>advanced</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>source_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    This handles the relation information being created from the</span>
<span class=sd>    one_to_many functions in association.</span>

<span class=sd>    Args:</span>
<span class=sd>        row:</span>
<span class=sd>            The relation information Series from the association dataframe.</span>
<span class=sd>            Only the columns [&#39;related_skyc1&#39;, &#39;source_skyc1&#39;] are required</span>
<span class=sd>            for advanced, these are instead called [&#39;related&#39;, &#39;source&#39;]</span>
<span class=sd>            for basic.</span>
<span class=sd>        advanced:</span>
<span class=sd>            Whether advanced association is being used which changes the names</span>
<span class=sd>            of the columns involved.</span>
<span class=sd>        source_ids:</span>
<span class=sd>            A dataframe that contains the other ids to append to related for</span>
<span class=sd>            each original source.</span>
<span class=sd>            +----------------+--------+</span>
<span class=sd>            |   source_skyc1 | 0      |</span>
<span class=sd>            |----------------+--------|</span>
<span class=sd>            |            122 | [5542] |</span>
<span class=sd>            |            254 | [5543] |</span>
<span class=sd>            |            262 | [5544] |</span>
<span class=sd>            |            405 | [5545] |</span>
<span class=sd>            |            656 | [5546] |</span>
<span class=sd>            +----------------+--------+</span>

<span class=sd>    Returns:</span>
<span class=sd>        The new related field for the source in question, containing the</span>
<span class=sd>            appended ids.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>source_ids</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>source_ids</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>()</span>

    <span class=n>related_col</span> <span class=o>=</span> <span class=s1>&#39;related_skyc1&#39;</span> <span class=k>if</span> <span class=n>advanced</span> <span class=k>else</span> <span class=s1>&#39;related&#39;</span>
    <span class=n>source_col</span> <span class=o>=</span> <span class=s1>&#39;source_skyc1&#39;</span> <span class=k>if</span> <span class=n>advanced</span> <span class=k>else</span> <span class=s1>&#39;source&#39;</span>

    <span class=c1># this is the not_original case where the original source id is appended.</span>
    <span class=k>if</span> <span class=n>source_ids</span><span class=o>.</span><span class=n>empty</span><span class=p>:</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=n>related_col</span><span class=p>],</span> <span class=nb>list</span><span class=p>):</span>
            <span class=n>out</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=n>related_col</span><span class=p>]</span>
            <span class=n>out</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=n>source_col</span><span class=p>])</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>out</span> <span class=o>=</span> <span class=p>[</span><span class=n>row</span><span class=p>[</span><span class=n>source_col</span><span class=p>],</span> <span class=p>]</span>

    <span class=k>else</span><span class=p>:</span>  <span class=c1># the original case to append all the new ids.</span>
        <span class=n>source_ids</span> <span class=o>=</span> <span class=n>source_ids</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>row</span><span class=p>[</span><span class=n>source_col</span><span class=p>]]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=n>related_col</span><span class=p>],</span> <span class=nb>list</span><span class=p>):</span>
            <span class=n>out</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=n>related_col</span><span class=p>]</span> <span class=o>+</span> <span class=n>source_ids</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>out</span> <span class=o>=</span> <span class=n>source_ids</span>

    <span class=k>return</span> <span class=n>out</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.add_run_to_img class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_run_to_img</span><span class=p>(</span><span class=n>pipeline_run</span><span class=p>,</span> <span class=n>img</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.add_run_to_img class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Add a pipeline run to an Image (and corresponding SkyRegion) in the db</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>pipeline_run</code></td> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.models.Run" href="../../models/#vast_pipeline.models.Run">Run</a></code> </td> <td><p>Pipeline run object you want to add.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>img</code></td> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.models.Image" href="../../models/#vast_pipeline.models.Image">Image</a></code> </td> <td><p>Image object you want to add to.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code>None</code> </td> <td><p>None</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>add_run_to_img</span><span class=p>(</span><span class=n>pipeline_run</span><span class=p>:</span> <span class=n>Run</span><span class=p>,</span> <span class=n>img</span><span class=p>:</span> <span class=n>Image</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Add a pipeline run to an Image (and corresponding SkyRegion) in the db</span>

<span class=sd>    Args:</span>
<span class=sd>        pipeline_run:</span>
<span class=sd>            Pipeline run object you want to add.</span>
<span class=sd>        img:</span>
<span class=sd>            Image object you want to add to.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>skyreg</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>skyreg</span>
    <span class=c1># check and add the many to many if not existent</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>Image</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=n>img</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>run__id</span><span class=o>=</span><span class=n>pipeline_run</span><span class=o>.</span><span class=n>id</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Adding </span><span class=si>%s</span><span class=s1> to image </span><span class=si>%s</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>pipeline_run</span><span class=p>,</span> <span class=n>img</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
        <span class=n>img</span><span class=o>.</span><span class=n>run</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>pipeline_run</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>pipeline_run</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>skyreg</span><span class=o>.</span><span class=n>run</span><span class=o>.</span><span class=n>all</span><span class=p>():</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Adding </span><span class=si>%s</span><span class=s1> to sky region </span><span class=si>%s</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>pipeline_run</span><span class=p>,</span> <span class=n>skyreg</span><span class=p>)</span>
        <span class=n>skyreg</span><span class=o>.</span><span class=n>run</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>pipeline_run</span><span class=p>)</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.backup_parquets class="doc doc-heading"> <code class="highlight language-python"><span class=n>backup_parquets</span><span class=p>(</span><span class=n>p_run_path</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.backup_parquets class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Backups up all the existing parquet files in a pipeline run directory. Backups are named with a '.bak' suffix in the pipeline run directory.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>p_run_path</code></td> <td> <code>str</code> </td> <td><p>The path of the pipeline run where the parquets are stored.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code>None</code> </td> <td><p>None</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>backup_parquets</span><span class=p>(</span><span class=n>p_run_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Backups up all the existing parquet files in a pipeline run directory.</span>
<span class=sd>    Backups are named with a &#39;.bak&#39; suffix in the pipeline run directory.</span>

<span class=sd>    Args:</span>
<span class=sd>        p_run_path:</span>
<span class=sd>            The path of the pipeline run where the parquets are stored.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>parquets</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>p_run_path</span><span class=p>,</span> <span class=s2>&quot;*.parquet&quot;</span><span class=p>))</span>
        <span class=c1># TODO Remove arrow when arrow files are no longer required.</span>
        <span class=o>+</span> <span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>p_run_path</span><span class=p>,</span> <span class=s2>&quot;*.arrow&quot;</span><span class=p>)))</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>parquets</span><span class=p>:</span>
        <span class=n>backup_name</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=s1>&#39;.bak&#39;</span>
        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>backup_name</span><span class=p>):</span>
            <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Removing old backup file: </span><span class=si>{</span><span class=n>backup_name</span><span class=si>}</span><span class=s1>.&#39;</span><span class=p>)</span>
            <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>backup_name</span><span class=p>)</span>
        <span class=n>shutil</span><span class=o>.</span><span class=n>copyfile</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>backup_name</span><span class=p>)</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.calc_ave_coord class="doc doc-heading"> <code class="highlight language-python"><span class=n>calc_ave_coord</span><span class=p>(</span><span class=n>grp</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.calc_ave_coord class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Calculates the average coordinate of the grouped by sources dataframe for each unique group, along with defining the image and epoch list for each unique source (group).</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>grp</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The current group dataframe (unique source) of the grouped by dataframe being acted upon.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code> </td> <td><p>A pandas series containing the average coordinate along with the image and epoch lists.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span>
<span class=normal>732</span>
<span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span>
<span class=normal>741</span>
<span class=normal>742</span>
<span class=normal>743</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>calc_ave_coord</span><span class=p>(</span><span class=n>grp</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculates the average coordinate of the grouped by sources dataframe for</span>
<span class=sd>    each unique group, along with defining the image and epoch list for each</span>
<span class=sd>    unique source (group).</span>

<span class=sd>    Args:</span>
<span class=sd>        grp: The current group dataframe (unique source) of the grouped by</span>
<span class=sd>            dataframe being acted upon.</span>

<span class=sd>    Returns:</span>
<span class=sd>        A pandas series containing the average coordinate along with the</span>
<span class=sd>            image and epoch lists.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>d</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=n>grp</span> <span class=o>=</span> <span class=n>grp</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;datetime&#39;</span><span class=p>)</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;img_list&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>grp</span><span class=p>[</span><span class=s1>&#39;image&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;epoch_list&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>grp</span><span class=p>[</span><span class=s1>&#39;epoch&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>grp</span><span class=p>[</span><span class=s1>&#39;interim_ew&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span> <span class=o>/</span> <span class=n>grp</span><span class=p>[</span><span class=s1>&#39;weight_ew&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>grp</span><span class=p>[</span><span class=s1>&#39;interim_ns&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span> <span class=o>/</span> <span class=n>grp</span><span class=p>[</span><span class=s1>&#39;weight_ns&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>

    <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.check_primary_image class="doc doc-heading"> <code class="highlight language-python"><span class=n>check_primary_image</span><span class=p>(</span><span class=n>row</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.check_primary_image class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Checks whether the primary image of the ideal source dataframe is in the image list for the source.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>row</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code> </td> <td><p>Input dataframe row, with columns ['primary'] and ['img_list'].</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code>bool</code> </td> <td><p>True if primary in image list else False.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>875</span>
<span class=normal>876</span>
<span class=normal>877</span>
<span class=normal>878</span>
<span class=normal>879</span>
<span class=normal>880</span>
<span class=normal>881</span>
<span class=normal>882</span>
<span class=normal>883</span>
<span class=normal>884</span>
<span class=normal>885</span>
<span class=normal>886</span>
<span class=normal>887</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>check_primary_image</span><span class=p>(</span><span class=n>row</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Checks whether the primary image of the ideal source</span>
<span class=sd>    dataframe is in the image list for the source.</span>

<span class=sd>    Args:</span>
<span class=sd>        row:</span>
<span class=sd>            Input dataframe row, with columns [&#39;primary&#39;] and [&#39;img_list&#39;].</span>

<span class=sd>    Returns:</span>
<span class=sd>        True if primary in image list else False.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;primary&#39;</span><span class=p>]</span> <span class=ow>in</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;img_list&#39;</span><span class=p>]</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.create_measurement_pairs_arrow_file class="doc doc-heading"> <code class="highlight language-python"><span class=n>create_measurement_pairs_arrow_file</span><span class=p>(</span><span class=n>p_run</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.create_measurement_pairs_arrow_file class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Creates a measurement_pairs.arrow file using the parquet outputs of a pipeline run.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>p_run</code></td> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.models.Run" href="../../models/#vast_pipeline.models.Run">Run</a></code> </td> <td><p>Pipeline model instance.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code>None</code> </td> <td><p>None</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>create_measurement_pairs_arrow_file</span><span class=p>(</span><span class=n>p_run</span><span class=p>:</span> <span class=n>Run</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Creates a measurement_pairs.arrow file using the parquet outputs</span>
<span class=sd>    of a pipeline run.</span>

<span class=sd>    Args:</span>
<span class=sd>        p_run:</span>
<span class=sd>            Pipeline model instance.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Creating measurement_pairs.arrow for run </span><span class=si>%s</span><span class=s1>.&#39;</span><span class=p>,</span> <span class=n>p_run</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>

    <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>p_run</span><span class=o>.</span><span class=n>path</span><span class=p>,</span>
            <span class=s1>&#39;measurement_pairs.parquet&#39;</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Optimising dataframe.&#39;</span><span class=p>)</span>
    <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>optimize_ints</span><span class=p>(</span><span class=n>optimize_floats</span><span class=p>(</span><span class=n>measurement_pairs_df</span><span class=p>))</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Loading to pyarrow table.&quot;</span><span class=p>)</span>
    <span class=n>measurement_pairs_df</span> <span class=o>=</span> <span class=n>pa</span><span class=o>.</span><span class=n>Table</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>measurement_pairs_df</span><span class=p>)</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Exporting to arrow file.&quot;</span><span class=p>)</span>
    <span class=n>outname</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>p_run</span><span class=o>.</span><span class=n>path</span><span class=p>,</span> <span class=s1>&#39;measurement_pairs.arrow&#39;</span><span class=p>)</span>

    <span class=n>local</span> <span class=o>=</span> <span class=n>pa</span><span class=o>.</span><span class=n>fs</span><span class=o>.</span><span class=n>LocalFileSystem</span><span class=p>()</span>

    <span class=k>with</span> <span class=n>local</span><span class=o>.</span><span class=n>open_output_stream</span><span class=p>(</span><span class=n>outname</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
        <span class=k>with</span> <span class=n>pa</span><span class=o>.</span><span class=n>RecordBatchFileWriter</span><span class=p>(</span><span class=n>file</span><span class=p>,</span> <span class=n>measurement_pairs_df</span><span class=o>.</span><span class=n>schema</span><span class=p>)</span> <span class=k>as</span> <span class=n>writer</span><span class=p>:</span>
            <span class=n>writer</span><span class=o>.</span><span class=n>write_table</span><span class=p>(</span><span class=n>measurement_pairs_df</span><span class=p>)</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.create_measurements_arrow_file class="doc doc-heading"> <code class="highlight language-python"><span class=n>create_measurements_arrow_file</span><span class=p>(</span><span class=n>p_run</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.create_measurements_arrow_file class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Creates a measurements.arrow file using the parquet outputs of a pipeline run.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>p_run</code></td> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.models.Run" href="../../models/#vast_pipeline.models.Run">Run</a></code> </td> <td><p>Pipeline model instance.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code>None</code> </td> <td><p>None</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1292</span>
<span class=normal>1293</span>
<span class=normal>1294</span>
<span class=normal>1295</span>
<span class=normal>1296</span>
<span class=normal>1297</span>
<span class=normal>1298</span>
<span class=normal>1299</span>
<span class=normal>1300</span>
<span class=normal>1301</span>
<span class=normal>1302</span>
<span class=normal>1303</span>
<span class=normal>1304</span>
<span class=normal>1305</span>
<span class=normal>1306</span>
<span class=normal>1307</span>
<span class=normal>1308</span>
<span class=normal>1309</span>
<span class=normal>1310</span>
<span class=normal>1311</span>
<span class=normal>1312</span>
<span class=normal>1313</span>
<span class=normal>1314</span>
<span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span>
<span class=normal>1324</span>
<span class=normal>1325</span>
<span class=normal>1326</span>
<span class=normal>1327</span>
<span class=normal>1328</span>
<span class=normal>1329</span>
<span class=normal>1330</span>
<span class=normal>1331</span>
<span class=normal>1332</span>
<span class=normal>1333</span>
<span class=normal>1334</span>
<span class=normal>1335</span>
<span class=normal>1336</span>
<span class=normal>1337</span>
<span class=normal>1338</span>
<span class=normal>1339</span>
<span class=normal>1340</span>
<span class=normal>1341</span>
<span class=normal>1342</span>
<span class=normal>1343</span>
<span class=normal>1344</span>
<span class=normal>1345</span>
<span class=normal>1346</span>
<span class=normal>1347</span>
<span class=normal>1348</span>
<span class=normal>1349</span>
<span class=normal>1350</span>
<span class=normal>1351</span>
<span class=normal>1352</span>
<span class=normal>1353</span>
<span class=normal>1354</span>
<span class=normal>1355</span>
<span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>create_measurements_arrow_file</span><span class=p>(</span><span class=n>p_run</span><span class=p>:</span> <span class=n>Run</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Creates a measurements.arrow file using the parquet outputs</span>
<span class=sd>    of a pipeline run.</span>

<span class=sd>    Args:</span>
<span class=sd>        p_run:</span>
<span class=sd>            Pipeline model instance.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Creating measurements.arrow for run </span><span class=si>%s</span><span class=s1>.&#39;</span><span class=p>,</span> <span class=n>p_run</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>

    <span class=n>associations</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>p_run</span><span class=o>.</span><span class=n>path</span><span class=p>,</span>
            <span class=s1>&#39;associations.parquet&#39;</span>
        <span class=p>)</span>
    <span class=p>)</span>
    <span class=n>images</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>p_run</span><span class=o>.</span><span class=n>path</span><span class=p>,</span>
            <span class=s1>&#39;images.parquet&#39;</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=n>m_files</span> <span class=o>=</span> <span class=n>images</span><span class=p>[</span><span class=s1>&#39;measurements_path&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>

    <span class=n>m_files</span> <span class=o>+=</span> <span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=n>p_run</span><span class=o>.</span><span class=n>path</span><span class=p>,</span>
        <span class=s1>&#39;forced*.parquet&#39;</span>
    <span class=p>))</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Loading </span><span class=si>%i</span><span class=s1> files...&#39;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>m_files</span><span class=p>))</span>
    <span class=n>measurements</span> <span class=o>=</span> <span class=n>dd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=n>m_files</span><span class=p>,</span> <span class=n>engine</span><span class=o>=</span><span class=s1>&#39;pyarrow&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>compute</span><span class=p>()</span>

    <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
        <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>associations</span><span class=p>[</span><span class=s1>&#39;meas_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>)</span>
    <span class=p>]</span>

    <span class=n>measurements</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>associations</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=p>[</span><span class=s1>&#39;meas_id&#39;</span><span class=p>,</span> <span class=s1>&#39;source_id&#39;</span><span class=p>]]</span>
        <span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;meas_id&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=n>measurements</span><span class=p>,</span>
            <span class=n>left_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>right_on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
        <span class=p>)</span>
        <span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;source_id&#39;</span><span class=p>:</span> <span class=s1>&#39;source&#39;</span><span class=p>})</span>
    <span class=p>)</span>

    <span class=c1># drop timezone from datetime for vaex compatibility</span>
    <span class=c1># TODO: Look to keep the timezone if/when vaex is compatible.</span>
    <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>dt</span><span class=o>.</span><span class=n>tz_localize</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Optimising dataframes.&#39;</span><span class=p>)</span>
    <span class=n>measurements</span> <span class=o>=</span> <span class=n>optimize_ints</span><span class=p>(</span><span class=n>optimize_floats</span><span class=p>(</span><span class=n>measurements</span><span class=p>))</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Loading to pyarrow table.&quot;</span><span class=p>)</span>
    <span class=n>measurements</span> <span class=o>=</span> <span class=n>pa</span><span class=o>.</span><span class=n>Table</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>measurements</span><span class=p>)</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Exporting to arrow file.&quot;</span><span class=p>)</span>
    <span class=n>outname</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>p_run</span><span class=o>.</span><span class=n>path</span><span class=p>,</span> <span class=s1>&#39;measurements.arrow&#39;</span><span class=p>)</span>

    <span class=n>local</span> <span class=o>=</span> <span class=n>pa</span><span class=o>.</span><span class=n>fs</span><span class=o>.</span><span class=n>LocalFileSystem</span><span class=p>()</span>

    <span class=k>with</span> <span class=n>local</span><span class=o>.</span><span class=n>open_output_stream</span><span class=p>(</span><span class=n>outname</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
        <span class=k>with</span> <span class=n>pa</span><span class=o>.</span><span class=n>RecordBatchFileWriter</span><span class=p>(</span><span class=n>file</span><span class=p>,</span> <span class=n>measurements</span><span class=o>.</span><span class=n>schema</span><span class=p>)</span> <span class=k>as</span> <span class=n>writer</span><span class=p>:</span>
            <span class=n>writer</span><span class=o>.</span><span class=n>write_table</span><span class=p>(</span><span class=n>measurements</span><span class=p>)</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.create_temp_config_file class="doc doc-heading"> <code class="highlight language-python"><span class=n>create_temp_config_file</span><span class=p>(</span><span class=n>p_run_path</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.create_temp_config_file class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Creates the temp config file which is saved at the beginning of each run.</p> <p>It is to avoid issues created by users changing the config while the run is running.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>p_run_path</code></td> <td> <code>str</code> </td> <td><p>The path of the pipeline run of the config to be copied.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code>None</code> </td> <td><p>None</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>create_temp_config_file</span><span class=p>(</span><span class=n>p_run_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Creates the temp config file which is saved at the beginning of each run.</span>

<span class=sd>    It is to avoid issues created by users changing the config while the run</span>
<span class=sd>    is running.</span>

<span class=sd>    Args:</span>
<span class=sd>        p_run_path:</span>
<span class=sd>            The path of the pipeline run of the config to be copied.</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>config_name</span> <span class=o>=</span> <span class=s1>&#39;config.yaml&#39;</span>
    <span class=n>temp_config_name</span> <span class=o>=</span> <span class=s1>&#39;config_temp.yaml&#39;</span>

    <span class=n>shutil</span><span class=o>.</span><span class=n>copyfile</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>p_run_path</span><span class=p>,</span> <span class=n>config_name</span><span class=p>),</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>p_run_path</span><span class=p>,</span> <span class=n>temp_config_name</span><span class=p>)</span>
    <span class=p>)</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.cross_join class="doc doc-heading"> <code class="highlight language-python"><span class=n>cross_join</span><span class=p>(</span><span class=n>left</span><span class=p>,</span> <span class=n>right</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.cross_join class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>A convenience function to merge two dataframes.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>left</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The base pandas DataFrame to merge.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>right</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The pandas DataFrame to merge to the left.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The resultant merged DataFrame.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>cross_join</span><span class=p>(</span><span class=n>left</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>right</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    A convenience function to merge two dataframes.</span>

<span class=sd>    Args:</span>
<span class=sd>        left: The base pandas DataFrame to merge.</span>
<span class=sd>        right: The pandas DataFrame to merge to the left.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The resultant merged DataFrame.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=p>(</span>
        <span class=n>left</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>right</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> <span class=n>on</span><span class=o>=</span><span class=s1>&#39;key&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=p>)</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.get_create_img class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_create_img</span><span class=p>(</span><span class=n>band_id</span><span class=p>,</span> <span class=n>image</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.get_create_img class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Function to fetch or create the Image and Sky Region objects for an image.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>band_id</code></td> <td> <code>int</code> </td> <td><p>The integer database id value of the frequency band of the image.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>image</code></td> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.image.main.SelavyImage" href="../../image/main/#vast_pipeline.image.main.SelavyImage">SelavyImage</a></code> </td> <td><p>The image object.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.models.Image" href="../../models/#vast_pipeline.models.Image">Image</a></code> </td> <td><p>The resulting image django ORM object.</p></td> </tr> <tr> <td> <code>bool</code> </td> <td><p><code>True</code> the image already existed in the database, <code>False</code> if not.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_create_img</span><span class=p>(</span><span class=n>band_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>image</span><span class=p>:</span> <span class=n>SelavyImage</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Image</span><span class=p>,</span> <span class=nb>bool</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Function to fetch or create the Image and Sky Region objects for an image.</span>

<span class=sd>    Args:</span>
<span class=sd>        band_id: The integer database id value of the frequency band of the</span>
<span class=sd>            image.</span>
<span class=sd>        image: The image object.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The resulting image django ORM object.</span>
<span class=sd>        `True` the image already existed in the database, `False` if not.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>images</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name__exact</span><span class=o>=</span><span class=n>image</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
    <span class=n>exists</span> <span class=o>=</span> <span class=n>images</span><span class=o>.</span><span class=n>exists</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>exists</span><span class=p>:</span>
        <span class=n>img</span><span class=p>:</span> <span class=n>Image</span> <span class=o>=</span> <span class=n>images</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
        <span class=c1># Add background path if not originally provided</span>
        <span class=k>if</span> <span class=n>image</span><span class=o>.</span><span class=n>background_path</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>img</span><span class=o>.</span><span class=n>background_path</span><span class=p>:</span>
            <span class=n>img</span><span class=o>.</span><span class=n>background_path</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>background_path</span>
            <span class=n>img</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=c1># at this stage, measurement parquet file is not created but</span>
        <span class=c1># assume location</span>
        <span class=n>img_folder_name</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=s1>&#39;_&#39;</span><span class=p>)</span>
        <span class=n>measurements_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>settings</span><span class=o>.</span><span class=n>PIPELINE_WORKING_DIR</span><span class=p>,</span>
            <span class=s1>&#39;images&#39;</span><span class=p>,</span>
            <span class=n>img_folder_name</span><span class=p>,</span>
            <span class=s1>&#39;measurements.parquet&#39;</span>
            <span class=p>)</span>
        <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span>
            <span class=n>band_id</span><span class=o>=</span><span class=n>band_id</span><span class=p>,</span>
            <span class=n>measurements_path</span><span class=o>=</span><span class=n>measurements_path</span>
        <span class=p>)</span>

        <span class=c1># set the attributes and save the image,</span>
        <span class=c1># by selecting only valid (not hidden) attributes</span>
        <span class=c1># FYI attributs and/or method starting with _ are hidden</span>
        <span class=c1># and with __ can&#39;t be modified/called</span>
        <span class=k>for</span> <span class=n>fld</span> <span class=ow>in</span> <span class=n>img</span><span class=o>.</span><span class=n>_meta</span><span class=o>.</span><span class=n>get_fields</span><span class=p>():</span>
            <span class=k>if</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>fld</span><span class=p>,</span> <span class=s1>&#39;attname&#39;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=nb>getattr</span><span class=p>(</span><span class=n>image</span><span class=p>,</span> <span class=n>fld</span><span class=o>.</span><span class=n>attname</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>):</span>
                <span class=nb>setattr</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>fld</span><span class=o>.</span><span class=n>attname</span><span class=p>,</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>image</span><span class=p>,</span> <span class=n>fld</span><span class=o>.</span><span class=n>attname</span><span class=p>))</span>

        <span class=n>img</span><span class=o>.</span><span class=n>rms_median</span><span class=p>,</span> <span class=n>img</span><span class=o>.</span><span class=n>rms_min</span><span class=p>,</span> <span class=n>img</span><span class=o>.</span><span class=n>rms_max</span> <span class=o>=</span> <span class=n>get_rms_noise_image_values</span><span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>noise_path</span><span class=p>)</span>

        <span class=c1># get create the sky region and associate with image</span>
        <span class=n>img</span><span class=o>.</span><span class=n>skyreg</span> <span class=o>=</span> <span class=n>get_create_skyreg</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
        <span class=n>img</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>

    <span class=k>return</span> <span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>exists</span><span class=p>)</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.get_create_img_band class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_create_img_band</span><span class=p>(</span><span class=n>image</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.get_create_img_band class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Return the existing Band row for the given FitsImage. An image is considered to belong to a band if its frequency is within some tolerance of the band's frequency. Returns a Band row or None if no matching band.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>image</code></td> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.image.main.FitsImage" href="../../image/main/#vast_pipeline.image.main.FitsImage">FitsImage</a></code> </td> <td><p>The image Django ORM object.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.models.Band" href="../../models/#vast_pipeline.models.Band">Band</a></code> </td> <td><p>The band Django ORM object.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_create_img_band</span><span class=p>(</span><span class=n>image</span><span class=p>:</span> <span class=n>FitsImage</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Band</span><span class=p>:</span>
    <span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Return the existing Band row for the given FitsImage.</span>
<span class=sd>    An image is considered to belong to a band if its frequency is within some</span>
<span class=sd>    tolerance of the band&#39;s frequency.</span>
<span class=sd>    Returns a Band row or None if no matching band.</span>

<span class=sd>    Args:</span>
<span class=sd>        image: The image Django ORM object.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The band Django ORM object.</span>
<span class=sd>    &#39;&#39;&#39;</span>
    <span class=c1># For now we match bands using the central frequency.</span>
    <span class=c1># This assumes that every band has a unique frequency,</span>
    <span class=c1># which is true for the data we&#39;ve used so far.</span>
    <span class=n>freq</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>image</span><span class=o>.</span><span class=n>freq_eff</span> <span class=o>*</span> <span class=mf>1.e-6</span><span class=p>)</span>
    <span class=n>freq_band</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>image</span><span class=o>.</span><span class=n>freq_bw</span> <span class=o>*</span> <span class=mf>1.e-6</span><span class=p>)</span>
    <span class=c1># TODO: refine the band query</span>
    <span class=k>for</span> <span class=n>band</span> <span class=ow>in</span> <span class=n>Band</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>():</span>
        <span class=n>diff</span> <span class=o>=</span> <span class=nb>abs</span><span class=p>(</span><span class=n>freq</span> <span class=o>-</span> <span class=n>band</span><span class=o>.</span><span class=n>frequency</span><span class=p>)</span> <span class=o>/</span> <span class=nb>float</span><span class=p>(</span><span class=n>band</span><span class=o>.</span><span class=n>frequency</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>diff</span> <span class=o>&lt;</span> <span class=mf>0.02</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>band</span>

    <span class=c1># no band has been found so create it</span>
    <span class=n>band</span> <span class=o>=</span> <span class=n>Band</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>freq</span><span class=p>),</span> <span class=n>frequency</span><span class=o>=</span><span class=n>freq</span><span class=p>,</span> <span class=n>bandwidth</span><span class=o>=</span><span class=n>freq_band</span><span class=p>)</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Adding new frequency band: </span><span class=si>%s</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>band</span><span class=p>)</span>
    <span class=n>band</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>

    <span class=k>return</span> <span class=n>band</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.get_create_p_run class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_create_p_run</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>user</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.get_create_p_run class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Get or create a pipeline run in db, return the run django object and a flag True/False if has been created or already exists.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>name</code></td> <td> <code>str</code> </td> <td><p>The name of the pipeline run.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>path</code></td> <td> <code>str</code> </td> <td><p>The system path to the pipeline run folder which contains the configuration file and where outputs will be saved.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>description</code></td> <td> <code>str</code> </td> <td><p>An optional description of the pipeline run.</p></td> <td> <code>None</code> </td> </tr> <tr> <td><code>user</code></td> <td> <code><span title="django.contrib.auth.models.User">User</span></code> </td> <td><p>The Django user that launched the pipeline run.</p></td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.models.Run" href="../../models/#vast_pipeline.models.Run">Run</a></code> </td> <td><p>The pipeline run object.</p></td> </tr> <tr> <td> <code>bool</code> </td> <td><p>Whether the pipeline run already existed ('True') or not ('False').</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_create_p_run</span><span class=p>(</span>
    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>user</span><span class=p>:</span> <span class=n>User</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Run</span><span class=p>,</span> <span class=nb>bool</span><span class=p>]:</span>
    <span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Get or create a pipeline run in db, return the run django object and</span>
<span class=sd>    a flag True/False if has been created or already exists.</span>

<span class=sd>    Args:</span>
<span class=sd>        name: The name of the pipeline run.</span>
<span class=sd>        path: The system path to the pipeline run folder which contains the</span>
<span class=sd>            configuration file and where outputs will be saved.</span>
<span class=sd>        description: An optional description of the pipeline run.</span>
<span class=sd>        user: The Django user that launched the pipeline run.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The pipeline run object.</span>
<span class=sd>        Whether the pipeline run already existed (&#39;True&#39;) or not (&#39;False&#39;).</span>
<span class=sd>    &#39;&#39;&#39;</span>
    <span class=n>p_run</span> <span class=o>=</span> <span class=n>Run</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name__exact</span><span class=o>=</span><span class=n>name</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>p_run</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>p_run</span><span class=o>.</span><span class=n>get</span><span class=p>(),</span> <span class=kc>True</span>

    <span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span> <span class=k>if</span> <span class=n>description</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>description</span>
    <span class=n>p_run</span> <span class=o>=</span> <span class=n>Run</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=n>description</span><span class=p>,</span> <span class=n>path</span><span class=o>=</span><span class=n>path</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>user</span><span class=p>:</span>
        <span class=n>p_run</span><span class=o>.</span><span class=n>user</span> <span class=o>=</span> <span class=n>user</span>
    <span class=n>p_run</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>

    <span class=k>return</span> <span class=n>p_run</span><span class=p>,</span> <span class=kc>False</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.get_create_skyreg class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_create_skyreg</span><span class=p>(</span><span class=n>image</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.get_create_skyreg class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>This creates a Sky Region object in Django ORM given the related image object.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>image</code></td> <td> <code><a class="autorefs autorefs-internal" title="vast_pipeline.models.Image" href="../../models/#vast_pipeline.models.Image">Image</a></code> </td> <td><p>The image Django ORM object.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="vast_pipeline.models.SkyRegion">SkyRegion</span></code> </td> <td><p>The sky region Django ORM object.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_create_skyreg</span><span class=p>(</span><span class=n>image</span><span class=p>:</span> <span class=n>Image</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SkyRegion</span><span class=p>:</span>
    <span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    This creates a Sky Region object in Django ORM given the related</span>
<span class=sd>    image object.</span>

<span class=sd>    Args:</span>
<span class=sd>        image: The image Django ORM object.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The sky region Django ORM object.</span>
<span class=sd>    &#39;&#39;&#39;</span>
    <span class=c1># In the calculations below, it is assumed the image has square</span>
    <span class=c1># pixels (this pipeline has been designed for ASKAP images, so it</span>
    <span class=c1># should always be square). It will likely give wrong results if not</span>
    <span class=n>skyregions</span> <span class=o>=</span> <span class=n>SkyRegion</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
        <span class=n>centre_ra</span><span class=o>=</span><span class=n>image</span><span class=o>.</span><span class=n>ra</span><span class=p>,</span>
        <span class=n>centre_dec</span><span class=o>=</span><span class=n>image</span><span class=o>.</span><span class=n>dec</span><span class=p>,</span>
        <span class=n>xtr_radius</span><span class=o>=</span><span class=n>image</span><span class=o>.</span><span class=n>fov_bmin</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=n>skyregions</span><span class=p>:</span>
        <span class=n>skyr</span> <span class=o>=</span> <span class=n>skyregions</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Found sky region </span><span class=si>%s</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>skyr</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span> <span class=o>=</span> <span class=n>eq_to_cart</span><span class=p>(</span><span class=n>image</span><span class=o>.</span><span class=n>ra</span><span class=p>,</span> <span class=n>image</span><span class=o>.</span><span class=n>dec</span><span class=p>)</span>
        <span class=n>skyr</span> <span class=o>=</span> <span class=n>SkyRegion</span><span class=p>(</span>
            <span class=n>centre_ra</span><span class=o>=</span><span class=n>image</span><span class=o>.</span><span class=n>ra</span><span class=p>,</span>
            <span class=n>centre_dec</span><span class=o>=</span><span class=n>image</span><span class=o>.</span><span class=n>dec</span><span class=p>,</span>
            <span class=n>width_ra</span><span class=o>=</span><span class=n>image</span><span class=o>.</span><span class=n>physical_bmin</span><span class=p>,</span>
            <span class=n>width_dec</span><span class=o>=</span><span class=n>image</span><span class=o>.</span><span class=n>physical_bmaj</span><span class=p>,</span>
            <span class=n>xtr_radius</span><span class=o>=</span><span class=n>image</span><span class=o>.</span><span class=n>fov_bmin</span><span class=p>,</span>
            <span class=n>x</span><span class=o>=</span><span class=n>x</span><span class=p>,</span>
            <span class=n>y</span><span class=o>=</span><span class=n>y</span><span class=p>,</span>
            <span class=n>z</span><span class=o>=</span><span class=n>z</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>skyr</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Created sky region </span><span class=si>%s</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>skyr</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>skyr</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.get_eta_metric class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_eta_metric</span><span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>df</span><span class=p>,</span> <span class=n>peak</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.get_eta_metric class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Calculates the eta variability metric of a source. Works on the grouped by dataframe using the fluxes of the associated measurements.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>row</code></td> <td> <code><span title="typing.Dict">Dict</span>[str, float]</code> </td> <td><p>Dictionary containing statistics for the current source.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>df</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The grouped by sources dataframe of the measurements containing all the flux and flux error information,</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>peak</code></td> <td> <code>bool</code> </td> <td><p>Whether to use peak_flux for the calculation. If False then the integrated flux is used.</p></td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code>float</code> </td> <td><p>The calculated eta value.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_eta_metric</span><span class=p>(</span>
    <span class=n>row</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>],</span> <span class=n>df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>peak</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
    <span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Calculates the eta variability metric of a source.</span>
<span class=sd>    Works on the grouped by dataframe using the fluxes</span>
<span class=sd>    of the associated measurements.</span>

<span class=sd>    Args:</span>
<span class=sd>        row: Dictionary containing statistics for the current source.</span>
<span class=sd>        df: The grouped by sources dataframe of the measurements containing all</span>
<span class=sd>            the flux and flux error information,</span>
<span class=sd>        peak: Whether to use peak_flux for the calculation. If False then the</span>
<span class=sd>            integrated flux is used.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The calculated eta value.</span>
<span class=sd>    &#39;&#39;&#39;</span>
    <span class=k>if</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;n_meas&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>return</span> <span class=mf>0.</span>

    <span class=n>suffix</span> <span class=o>=</span> <span class=s1>&#39;peak&#39;</span> <span class=k>if</span> <span class=n>peak</span> <span class=k>else</span> <span class=s1>&#39;int&#39;</span>
    <span class=n>weights</span> <span class=o>=</span> <span class=mf>1.</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;flux_</span><span class=si>{</span><span class=n>suffix</span><span class=si>}</span><span class=s1>_err&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=o>**</span><span class=mi>2</span>
    <span class=n>fluxes</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;flux_</span><span class=si>{</span><span class=n>suffix</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
    <span class=n>eta</span> <span class=o>=</span> <span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;n_meas&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;n_meas&#39;</span><span class=p>]</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span> <span class=o>*</span> <span class=p>(</span>
        <span class=p>(</span><span class=n>weights</span> <span class=o>*</span> <span class=n>fluxes</span><span class=o>**</span><span class=mi>2</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span> <span class=o>-</span> <span class=p>(</span>
            <span class=p>(</span><span class=n>weights</span> <span class=o>*</span> <span class=n>fluxes</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span><span class=o>**</span><span class=mi>2</span> <span class=o>/</span> <span class=n>weights</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
        <span class=p>)</span>
    <span class=p>)</span>
    <span class=k>return</span> <span class=n>eta</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.get_image_list_diff class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_image_list_diff</span><span class=p>(</span><span class=n>row</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.get_image_list_diff class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Calculate the difference between the ideal coverage image list of a source and the actual observed image list. Also checks whether an epoch does in fact contain a detection but is not in the expected 'ideal' image for that epoch.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>row</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code> </td> <td><p>The row from the sources dataframe that is being iterated over.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], int]</code> </td> <td><p>A list of the images missing from the observed image list.</p></td> </tr> <tr> <td> <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], int]</code> </td> <td><p>A '-1' integer value if there are no missing images.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>810</span>
<span class=normal>811</span>
<span class=normal>812</span>
<span class=normal>813</span>
<span class=normal>814</span>
<span class=normal>815</span>
<span class=normal>816</span>
<span class=normal>817</span>
<span class=normal>818</span>
<span class=normal>819</span>
<span class=normal>820</span>
<span class=normal>821</span>
<span class=normal>822</span>
<span class=normal>823</span>
<span class=normal>824</span>
<span class=normal>825</span>
<span class=normal>826</span>
<span class=normal>827</span>
<span class=normal>828</span>
<span class=normal>829</span>
<span class=normal>830</span>
<span class=normal>831</span>
<span class=normal>832</span>
<span class=normal>833</span>
<span class=normal>834</span>
<span class=normal>835</span>
<span class=normal>836</span>
<span class=normal>837</span>
<span class=normal>838</span>
<span class=normal>839</span>
<span class=normal>840</span>
<span class=normal>841</span>
<span class=normal>842</span>
<span class=normal>843</span>
<span class=normal>844</span>
<span class=normal>845</span>
<span class=normal>846</span>
<span class=normal>847</span>
<span class=normal>848</span>
<span class=normal>849</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_image_list_diff</span><span class=p>(</span><span class=n>row</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=nb>int</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculate the difference between the ideal coverage image list of a source</span>
<span class=sd>    and the actual observed image list. Also checks whether an epoch does in</span>
<span class=sd>    fact contain a detection but is not in the expected &#39;ideal&#39; image for that</span>
<span class=sd>    epoch.</span>

<span class=sd>    Args:</span>
<span class=sd>        row: The row from the sources dataframe that is being iterated over.</span>

<span class=sd>    Returns:</span>
<span class=sd>        A list of the images missing from the observed image list.</span>
<span class=sd>        A &#39;-1&#39; integer value if there are no missing images.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>out</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
        <span class=nb>filter</span><span class=p>(</span><span class=k>lambda</span> <span class=n>arg</span><span class=p>:</span> <span class=n>arg</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;img_list&#39;</span><span class=p>],</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;skyreg_img_list&#39;</span><span class=p>])</span>
    <span class=p>)</span>

    <span class=c1># set empty list to -1</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>out</span><span class=p>:</span>
        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>

    <span class=c1># Check that an epoch has not already been seen (just not in the &#39;ideal&#39;</span>
    <span class=c1># image)</span>
    <span class=n>out_epochs</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>row</span><span class=p>[</span><span class=s1>&#39;skyreg_epoch&#39;</span><span class=p>][</span><span class=n>pair</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span> <span class=k>for</span> <span class=n>pair</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span>
            <span class=n>row</span><span class=p>[</span><span class=s1>&#39;skyreg_img_list&#39;</span><span class=p>]</span>
        <span class=p>)</span> <span class=k>if</span> <span class=n>pair</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=ow>in</span> <span class=n>out</span>
    <span class=p>]</span>

    <span class=n>out</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>out</span><span class=p>[</span><span class=n>pair</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span> <span class=k>for</span> <span class=n>pair</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span>
            <span class=n>out_epochs</span>
        <span class=p>)</span> <span class=k>if</span> <span class=n>pair</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;epoch_list&#39;</span><span class=p>]</span>
    <span class=p>]</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>out</span><span class=p>:</span>
        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>

    <span class=k>return</span> <span class=n>out</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.get_names_and_epochs class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_names_and_epochs</span><span class=p>(</span><span class=n>grp</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.get_names_and_epochs class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Convenience function to group together the image names, epochs and datetimes into one list object which is then returned as a pandas series. This is necessary for easier processing in the ideal coverage analysis.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>grp</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>A group from the grouped by sources DataFrame.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code> </td> <td><p>Pandas series containing the list object that contains the lists of the image names, epochs and datetimes.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>852</span>
<span class=normal>853</span>
<span class=normal>854</span>
<span class=normal>855</span>
<span class=normal>856</span>
<span class=normal>857</span>
<span class=normal>858</span>
<span class=normal>859</span>
<span class=normal>860</span>
<span class=normal>861</span>
<span class=normal>862</span>
<span class=normal>863</span>
<span class=normal>864</span>
<span class=normal>865</span>
<span class=normal>866</span>
<span class=normal>867</span>
<span class=normal>868</span>
<span class=normal>869</span>
<span class=normal>870</span>
<span class=normal>871</span>
<span class=normal>872</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_names_and_epochs</span><span class=p>(</span><span class=n>grp</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Convenience function to group together the image names, epochs and</span>
<span class=sd>    datetimes into one list object which is then returned as a pandas series.</span>
<span class=sd>    This is necessary for easier processing in the ideal coverage analysis.</span>

<span class=sd>    Args:</span>
<span class=sd>        grp: A group from the grouped by sources DataFrame.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Pandas series containing the list object that contains the lists of the</span>
<span class=sd>            image names, epochs and datetimes.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>d</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;skyreg_img_epoch_list&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[[[</span><span class=n>x</span><span class=p>,</span> <span class=p>],</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>]</span> <span class=k>for</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span>
        <span class=n>grp</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>tolist</span><span class=p>(),</span>
        <span class=n>grp</span><span class=p>[</span><span class=s1>&#39;epoch&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>tolist</span><span class=p>(),</span>
        <span class=n>grp</span><span class=p>[</span><span class=s1>&#39;datetime&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
    <span class=p>)]</span>

    <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.get_parallel_assoc_image_df class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_parallel_assoc_image_df</span><span class=p>(</span><span class=n>images</span><span class=p>,</span> <span class=n>skyregion_groups</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.get_parallel_assoc_image_df class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Merge the sky region groups with the images and skyreg_ids.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>images</code></td> <td> <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="vast_pipeline.models.Image" href="../../models/#vast_pipeline.models.Image">Image</a>]</code> </td> <td><p>A list of the Image objects.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>skyregion_groups</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The sky region group of each skyregion id. +----+----------------+ | | skyreg_group | |----+----------------| | 2 | 1 | | 3 | 1 | | 1 | 2 | +----+----------------+</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>Dataframe containing the merged images and skyreg_id and skyreg_group (see source code for output format).</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1231</span>
<span class=normal>1232</span>
<span class=normal>1233</span>
<span class=normal>1234</span>
<span class=normal>1235</span>
<span class=normal>1236</span>
<span class=normal>1237</span>
<span class=normal>1238</span>
<span class=normal>1239</span>
<span class=normal>1240</span>
<span class=normal>1241</span>
<span class=normal>1242</span>
<span class=normal>1243</span>
<span class=normal>1244</span>
<span class=normal>1245</span>
<span class=normal>1246</span>
<span class=normal>1247</span>
<span class=normal>1248</span>
<span class=normal>1249</span>
<span class=normal>1250</span>
<span class=normal>1251</span>
<span class=normal>1252</span>
<span class=normal>1253</span>
<span class=normal>1254</span>
<span class=normal>1255</span>
<span class=normal>1256</span>
<span class=normal>1257</span>
<span class=normal>1258</span>
<span class=normal>1259</span>
<span class=normal>1260</span>
<span class=normal>1261</span>
<span class=normal>1262</span>
<span class=normal>1263</span>
<span class=normal>1264</span>
<span class=normal>1265</span>
<span class=normal>1266</span>
<span class=normal>1267</span>
<span class=normal>1268</span>
<span class=normal>1269</span>
<span class=normal>1270</span>
<span class=normal>1271</span>
<span class=normal>1272</span>
<span class=normal>1273</span>
<span class=normal>1274</span>
<span class=normal>1275</span>
<span class=normal>1276</span>
<span class=normal>1277</span>
<span class=normal>1278</span>
<span class=normal>1279</span>
<span class=normal>1280</span>
<span class=normal>1281</span>
<span class=normal>1282</span>
<span class=normal>1283</span>
<span class=normal>1284</span>
<span class=normal>1285</span>
<span class=normal>1286</span>
<span class=normal>1287</span>
<span class=normal>1288</span>
<span class=normal>1289</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_parallel_assoc_image_df</span><span class=p>(</span>
    <span class=n>images</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Image</span><span class=p>],</span> <span class=n>skyregion_groups</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Merge the sky region groups with the images and skyreg_ids.</span>

<span class=sd>    Args:</span>
<span class=sd>        images:</span>
<span class=sd>            A list of the Image objects.</span>
<span class=sd>        skyregion_groups:</span>
<span class=sd>            The sky region group of each skyregion id.</span>
<span class=sd>            +----+----------------+</span>
<span class=sd>            |    |   skyreg_group |</span>
<span class=sd>            |----+----------------|</span>
<span class=sd>            |  2 |              1 |</span>
<span class=sd>            |  3 |              1 |</span>
<span class=sd>            |  1 |              2 |</span>
<span class=sd>            +----+----------------+</span>

<span class=sd>    Returns:</span>
<span class=sd>        Dataframe containing the merged images and skyreg_id and skyreg_group</span>
<span class=sd>            (see source code for output format).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Output format</span>
    <span class=c1># +----+-------------------------------+-------------+----------------+</span>
    <span class=c1># |    | image                         |   skyreg_id |   skyreg_group |</span>
    <span class=c1># |----+-------------------------------+-------------+----------------|</span>
    <span class=c1># |  0 | VAST_2118+00A.EPOCH01.I.fits  |           2 |              1 |</span>
    <span class=c1># |  1 | VAST_2118-06A.EPOCH01.I.fits  |           3 |              1 |</span>
    <span class=c1># |  2 | VAST_0127-73A.EPOCH01.I.fits  |           1 |              2 |</span>
    <span class=c1># |  3 | VAST_2118-06A.EPOCH03x.I.fits |           3 |              1 |</span>
    <span class=c1># |  4 | VAST_2118-06A.EPOCH02.I.fits  |           3 |              1 |</span>
    <span class=c1># |  5 | VAST_2118-06A.EPOCH05x.I.fits |           3 |              1 |</span>
    <span class=c1># |  6 | VAST_2118-06A.EPOCH06x.I.fits |           3 |              1 |</span>
    <span class=c1># |  7 | VAST_0127-73A.EPOCH08.I.fits  |           1 |              2 |</span>
    <span class=c1># +----+-------------------------------+-------------+----------------+</span>
    <span class=n>skyreg_ids</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>skyreg_id</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>images</span><span class=p>]</span>

    <span class=n>images_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
        <span class=s1>&#39;image_dj&#39;</span><span class=p>:</span> <span class=n>images</span><span class=p>,</span>
        <span class=s1>&#39;skyreg_id&#39;</span><span class=p>:</span> <span class=n>skyreg_ids</span><span class=p>,</span>
    <span class=p>})</span>

    <span class=n>images_df</span> <span class=o>=</span> <span class=n>images_df</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
        <span class=n>skyregion_groups</span><span class=p>,</span>
        <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span>
        <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;skyreg_id&#39;</span><span class=p>,</span>
        <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>

    <span class=n>images_df</span><span class=p>[</span><span class=s1>&#39;image_name&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>images_df</span><span class=p>[</span><span class=s1>&#39;image_dj&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>name</span>
    <span class=p>)</span>

    <span class=n>images_df</span><span class=p>[</span><span class=s1>&#39;image_datetime&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>images_df</span><span class=p>[</span><span class=s1>&#39;image_dj&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>datetime</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>images_df</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.get_rms_noise_image_values class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_rms_noise_image_values</span><span class=p>(</span><span class=n>rms_path</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.get_rms_noise_image_values class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Open the RMS noise FITS file and compute the median, max and min rms values to be added to the image model and then used in the calculations.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>rms_path</code></td> <td> <code>str</code> </td> <td><p>The system path to the RMS FITS image.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code>float</code> </td> <td><p>The median value of the RMS image.</p></td> </tr> <tr> <td> <code>float</code> </td> <td><p>The minimum value of the RMS image.</p></td> </tr> <tr> <td> <code>float</code> </td> <td><p>The maximum value of the RMS image.</p></td> </tr> </tbody> </table> <p><strong>Raises:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code>IOError</code> </td> <td><p>Raised when the RMS FITS file cannot be found.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>776</span>
<span class=normal>777</span>
<span class=normal>778</span>
<span class=normal>779</span>
<span class=normal>780</span>
<span class=normal>781</span>
<span class=normal>782</span>
<span class=normal>783</span>
<span class=normal>784</span>
<span class=normal>785</span>
<span class=normal>786</span>
<span class=normal>787</span>
<span class=normal>788</span>
<span class=normal>789</span>
<span class=normal>790</span>
<span class=normal>791</span>
<span class=normal>792</span>
<span class=normal>793</span>
<span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span>
<span class=normal>804</span>
<span class=normal>805</span>
<span class=normal>806</span>
<span class=normal>807</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_rms_noise_image_values</span><span class=p>(</span><span class=n>rms_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
    <span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Open the RMS noise FITS file and compute the median, max and min</span>
<span class=sd>    rms values to be added to the image model and then used in the</span>
<span class=sd>    calculations.</span>

<span class=sd>    Args:</span>
<span class=sd>        rms_path: The system path to the RMS FITS image.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The median value of the RMS image.</span>
<span class=sd>        The minimum value of the RMS image.</span>
<span class=sd>        The maximum value of the RMS image.</span>

<span class=sd>    Raises:</span>
<span class=sd>        IOError: Raised when the RMS FITS file cannot be found.</span>
<span class=sd>    &#39;&#39;&#39;</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Extracting Image RMS values from Noise file...&#39;</span><span class=p>)</span>
    <span class=n>med_val</span> <span class=o>=</span> <span class=n>min_val</span> <span class=o>=</span> <span class=n>max_val</span> <span class=o>=</span> <span class=mf>0.</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>with</span> <span class=n>fits</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>rms_path</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
            <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>data</span>
            <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>logical_not</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>data</span><span class=p>))]</span>
            <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>data</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>]</span>
            <span class=n>med_val</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>median</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>*</span> <span class=mf>1e+3</span>
            <span class=n>min_val</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>*</span> <span class=mf>1e+3</span>
            <span class=n>max_val</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>*</span> <span class=mf>1e+3</span>
            <span class=k>del</span> <span class=n>data</span>
    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>IOError</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Could not read this RMS FITS file: </span><span class=si>{</span><span class=n>rms_path</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>med_val</span><span class=p>,</span> <span class=n>min_val</span><span class=p>,</span> <span class=n>max_val</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.get_src_skyregion_merged_df class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_src_skyregion_merged_df</span><span class=p>(</span><span class=n>sources_df</span><span class=p>,</span> <span class=n>images_df</span><span class=p>,</span> <span class=n>skyreg_df</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.get_src_skyregion_merged_df class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Analyses the current sources_df to determine what the 'ideal coverage' for each source should be. In other words, what images is the source missing in when it should have been seen.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>sources_df</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The output of the association step containing the measurements associated into sources.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>images_df</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>Contains the images of the pipeline run. I.e. all image objects for the run loaded into a dataframe.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>skyreg_df</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>Contains the sky regions of the pipeline run. I.e. all sky region objects for the run loaded into a dataframe.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>DataFrame containing missing image information (see source code for dataframe format).</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 890</span>
<span class=normal> 891</span>
<span class=normal> 892</span>
<span class=normal> 893</span>
<span class=normal> 894</span>
<span class=normal> 895</span>
<span class=normal> 896</span>
<span class=normal> 897</span>
<span class=normal> 898</span>
<span class=normal> 899</span>
<span class=normal> 900</span>
<span class=normal> 901</span>
<span class=normal> 902</span>
<span class=normal> 903</span>
<span class=normal> 904</span>
<span class=normal> 905</span>
<span class=normal> 906</span>
<span class=normal> 907</span>
<span class=normal> 908</span>
<span class=normal> 909</span>
<span class=normal> 910</span>
<span class=normal> 911</span>
<span class=normal> 912</span>
<span class=normal> 913</span>
<span class=normal> 914</span>
<span class=normal> 915</span>
<span class=normal> 916</span>
<span class=normal> 917</span>
<span class=normal> 918</span>
<span class=normal> 919</span>
<span class=normal> 920</span>
<span class=normal> 921</span>
<span class=normal> 922</span>
<span class=normal> 923</span>
<span class=normal> 924</span>
<span class=normal> 925</span>
<span class=normal> 926</span>
<span class=normal> 927</span>
<span class=normal> 928</span>
<span class=normal> 929</span>
<span class=normal> 930</span>
<span class=normal> 931</span>
<span class=normal> 932</span>
<span class=normal> 933</span>
<span class=normal> 934</span>
<span class=normal> 935</span>
<span class=normal> 936</span>
<span class=normal> 937</span>
<span class=normal> 938</span>
<span class=normal> 939</span>
<span class=normal> 940</span>
<span class=normal> 941</span>
<span class=normal> 942</span>
<span class=normal> 943</span>
<span class=normal> 944</span>
<span class=normal> 945</span>
<span class=normal> 946</span>
<span class=normal> 947</span>
<span class=normal> 948</span>
<span class=normal> 949</span>
<span class=normal> 950</span>
<span class=normal> 951</span>
<span class=normal> 952</span>
<span class=normal> 953</span>
<span class=normal> 954</span>
<span class=normal> 955</span>
<span class=normal> 956</span>
<span class=normal> 957</span>
<span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span>
<span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>get_src_skyregion_merged_df</span><span class=p>(</span>
    <span class=n>sources_df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>images_df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>skyreg_df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Analyses the current sources_df to determine what the &#39;ideal coverage&#39;</span>
<span class=sd>    for each source should be. In other words, what images is the source</span>
<span class=sd>    missing in when it should have been seen.</span>

<span class=sd>    Args:</span>
<span class=sd>        sources_df:</span>
<span class=sd>            The output of the association  step containing the</span>
<span class=sd>            measurements associated into sources.</span>
<span class=sd>        images_df:</span>
<span class=sd>            Contains the images of the pipeline run. I.e. all image</span>
<span class=sd>            objects for the run loaded into a dataframe.</span>
<span class=sd>        skyreg_df:</span>
<span class=sd>            Contains the sky regions of the pipeline run. I.e. all</span>
<span class=sd>            sky region objects for the run loaded into a dataframe.</span>

<span class=sd>    Returns:</span>
<span class=sd>        DataFrame containing missing image information (see source code for</span>
<span class=sd>            dataframe format).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Output format:</span>
    <span class=c1># +----------+----------------------------------+-----------+------------+</span>
    <span class=c1># |   source | img_list                         |   wavg_ra |   wavg_dec |</span>
    <span class=c1># |----------+----------------------------------+-----------+------------+</span>
    <span class=c1># |      278 | [&#39;VAST_0127-73A.EPOCH01.I.fits&#39;] |  22.2929  |   -71.8717 |</span>
    <span class=c1># |      702 | [&#39;VAST_0127-73A.EPOCH01.I.fits&#39;] |  28.8125  |   -69.3547 |</span>
    <span class=c1># |      844 | [&#39;VAST_0127-73A.EPOCH01.I.fits&#39;] |  17.3152  |   -72.346  |</span>
    <span class=c1># |      934 | [&#39;VAST_0127-73A.EPOCH01.I.fits&#39;] |   9.75754 |   -72.9629 |</span>
    <span class=c1># |     1290 | [&#39;VAST_0127-73A.EPOCH01.I.fits&#39;] |  20.8455  |   -76.8269 |</span>
    <span class=c1># +----------+----------------------------------+-----------+------------+</span>
    <span class=c1># ------------------------------------------------------------------+</span>
    <span class=c1>#  skyreg_img_list                                                  |</span>
    <span class=c1># ------------------------------------------------------------------+</span>
    <span class=c1>#  [&#39;VAST_0127-73A.EPOCH01.I.fits&#39;, &#39;VAST_0127-73A.EPOCH08.I.fits&#39;] |</span>
    <span class=c1>#  [&#39;VAST_0127-73A.EPOCH01.I.fits&#39;, &#39;VAST_0127-73A.EPOCH08.I.fits&#39;] |</span>
    <span class=c1>#  [&#39;VAST_0127-73A.EPOCH01.I.fits&#39;, &#39;VAST_0127-73A.EPOCH08.I.fits&#39;] |</span>
    <span class=c1>#  [&#39;VAST_0127-73A.EPOCH01.I.fits&#39;, &#39;VAST_0127-73A.EPOCH08.I.fits&#39;] |</span>
    <span class=c1>#  [&#39;VAST_0127-73A.EPOCH01.I.fits&#39;, &#39;VAST_0127-73A.EPOCH08.I.fits&#39;] |</span>
    <span class=c1># ------------------------------------------------------------------+</span>
    <span class=c1># ----------------------------------+------------------------------+</span>
    <span class=c1>#  img_diff                         | primary                      |</span>
    <span class=c1># ----------------------------------+------------------------------+</span>
    <span class=c1>#  [&#39;VAST_0127-73A.EPOCH08.I.fits&#39;] | VAST_0127-73A.EPOCH01.I.fits |</span>
    <span class=c1>#  [&#39;VAST_0127-73A.EPOCH08.I.fits&#39;] | VAST_0127-73A.EPOCH01.I.fits |</span>
    <span class=c1>#  [&#39;VAST_0127-73A.EPOCH08.I.fits&#39;] | VAST_0127-73A.EPOCH01.I.fits |</span>
    <span class=c1>#  [&#39;VAST_0127-73A.EPOCH08.I.fits&#39;] | VAST_0127-73A.EPOCH01.I.fits |</span>
    <span class=c1>#  [&#39;VAST_0127-73A.EPOCH08.I.fits&#39;] | VAST_0127-73A.EPOCH01.I.fits |</span>
    <span class=c1># ----------------------------------+------------------------------+</span>
    <span class=c1># ------------------------------+--------------+</span>
    <span class=c1>#  detection                    | in_primary   |</span>
    <span class=c1># ------------------------------+--------------|</span>
    <span class=c1>#  VAST_0127-73A.EPOCH01.I.fits | True         |</span>
    <span class=c1>#  VAST_0127-73A.EPOCH01.I.fits | True         |</span>
    <span class=c1>#  VAST_0127-73A.EPOCH01.I.fits | True         |</span>
    <span class=c1>#  VAST_0127-73A.EPOCH01.I.fits | True         |</span>
    <span class=c1>#  VAST_0127-73A.EPOCH01.I.fits | True         |</span>
    <span class=c1># ------------------------------+--------------+</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Creating ideal source coverage df...&quot;</span><span class=p>)</span>

    <span class=n>merged_timer</span> <span class=o>=</span> <span class=n>StopWatch</span><span class=p>()</span>

    <span class=n>skyreg_df</span> <span class=o>=</span> <span class=n>skyreg_df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
        <span class=p>[</span><span class=s1>&#39;x&#39;</span><span class=p>,</span> <span class=s1>&#39;y&#39;</span><span class=p>,</span> <span class=s1>&#39;z&#39;</span><span class=p>,</span> <span class=s1>&#39;width_ra&#39;</span><span class=p>,</span> <span class=s1>&#39;width_dec&#39;</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>

    <span class=n>images_df</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>images_df</span><span class=p>[</span><span class=s1>&#39;image_dj&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>name</span>
    <span class=p>)</span>
    <span class=n>images_df</span><span class=p>[</span><span class=s1>&#39;datetime&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>images_df</span><span class=p>[</span><span class=s1>&#39;image_dj&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>datetime</span>
    <span class=p>)</span>

    <span class=n>skyreg_df</span> <span class=o>=</span> <span class=n>skyreg_df</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
            <span class=n>images_df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;skyreg_id&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
                <span class=n>get_names_and_epochs</span>
            <span class=p>)</span>
        <span class=p>),</span>
        <span class=n>on</span><span class=o>=</span><span class=s1>&#39;id&#39;</span>
    <span class=p>)</span>

    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;datetime&#39;</span><span class=p>)</span>
    <span class=c1># calculate some metrics on sources</span>
    <span class=c1># compute only some necessary metrics in the groupby</span>
    <span class=n>timer</span> <span class=o>=</span> <span class=n>StopWatch</span><span class=p>()</span>
    <span class=n>srcs_df</span> <span class=o>=</span> <span class=n>parallel_groupby_coord</span><span class=p>(</span><span class=n>sources_df</span><span class=p>)</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Groupby-apply time: </span><span class=si>%.2f</span><span class=s1> seconds&#39;</span><span class=p>,</span> <span class=n>timer</span><span class=o>.</span><span class=n>reset</span><span class=p>())</span>

    <span class=k>del</span> <span class=n>sources_df</span>

    <span class=c1># crossmatch sources with sky regions up to the max sky region radius</span>
    <span class=n>skyreg_coords</span> <span class=o>=</span> <span class=n>SkyCoord</span><span class=p>(</span>
        <span class=n>ra</span><span class=o>=</span><span class=n>skyreg_df</span><span class=o>.</span><span class=n>centre_ra</span><span class=p>,</span> <span class=n>dec</span><span class=o>=</span><span class=n>skyreg_df</span><span class=o>.</span><span class=n>centre_dec</span><span class=p>,</span> <span class=n>unit</span><span class=o>=</span><span class=s2>&quot;deg&quot;</span>
    <span class=p>)</span>
    <span class=n>srcs_coords</span> <span class=o>=</span> <span class=n>SkyCoord</span><span class=p>(</span><span class=n>ra</span><span class=o>=</span><span class=n>srcs_df</span><span class=o>.</span><span class=n>wavg_ra</span><span class=p>,</span> <span class=n>dec</span><span class=o>=</span><span class=n>srcs_df</span><span class=o>.</span><span class=n>wavg_dec</span><span class=p>,</span> <span class=n>unit</span><span class=o>=</span><span class=s2>&quot;deg&quot;</span><span class=p>)</span>
    <span class=n>skyreg_idx</span><span class=p>,</span> <span class=n>srcs_idx</span><span class=p>,</span> <span class=n>sep</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>srcs_coords</span><span class=o>.</span><span class=n>search_around_sky</span><span class=p>(</span>
        <span class=n>skyreg_coords</span><span class=p>,</span> <span class=n>skyreg_df</span><span class=o>.</span><span class=n>xtr_radius</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>*</span> <span class=n>u</span><span class=o>.</span><span class=n>deg</span>
    <span class=p>)</span>
    <span class=n>skyreg_df</span> <span class=o>=</span> <span class=n>skyreg_df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;centre_ra&quot;</span><span class=p>,</span> <span class=s2>&quot;centre_dec&quot;</span><span class=p>])</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s2>&quot;id&quot;</span><span class=p>)</span>

    <span class=c1># select rows where separation is less than sky region radius</span>
    <span class=c1># drop not more useful columns and groupby source id</span>
    <span class=c1># compute list of images</span>
    <span class=n>src_skyrg_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
            <span class=p>{</span>
                <span class=s2>&quot;source&quot;</span><span class=p>:</span> <span class=n>srcs_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>srcs_idx</span><span class=p>]</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
                <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>skyreg_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>skyreg_idx</span><span class=p>]</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
                <span class=s2>&quot;sep&quot;</span><span class=p>:</span> <span class=n>sep</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=s2>&quot;deg&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
            <span class=p>}</span>
        <span class=p>)</span>
        <span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>skyreg_df</span><span class=p>,</span> <span class=n>left_on</span><span class=o>=</span><span class=s2>&quot;id&quot;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=s2>&quot;sep &lt; xtr_radius&quot;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>,</span> <span class=s2>&quot;xtr_radius&quot;</span><span class=p>])</span>
        <span class=o>.</span><span class=n>explode</span><span class=p>(</span><span class=s2>&quot;skyreg_img_epoch_list&quot;</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=k>del</span> <span class=n>skyreg_df</span>

    <span class=n>src_skyrg_df</span><span class=p>[</span>
        <span class=p>[</span><span class=s1>&#39;skyreg_img_list&#39;</span><span class=p>,</span> <span class=s1>&#39;skyreg_epoch&#39;</span><span class=p>,</span> <span class=s1>&#39;skyreg_datetime&#39;</span><span class=p>]</span>
    <span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
        <span class=n>src_skyrg_df</span><span class=p>[</span><span class=s1>&#39;skyreg_img_epoch_list&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>(),</span>
        <span class=n>index</span><span class=o>=</span><span class=n>src_skyrg_df</span><span class=o>.</span><span class=n>index</span>
    <span class=p>)</span>

    <span class=n>src_skyrg_df</span> <span class=o>=</span> <span class=n>src_skyrg_df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;skyreg_img_epoch_list&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=n>src_skyrg_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>src_skyrg_df</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span>
            <span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>,</span> <span class=s1>&#39;sep&#39;</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=o>.</span><span class=n>drop_duplicates</span><span class=p>([</span><span class=s1>&#39;source&#39;</span><span class=p>,</span> <span class=s1>&#39;skyreg_epoch&#39;</span><span class=p>])</span>
        <span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;skyreg_datetime&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>drop</span><span class=p>(</span>
            <span class=p>[</span><span class=s1>&#39;sep&#39;</span><span class=p>,</span> <span class=s1>&#39;skyreg_datetime&#39;</span><span class=p>],</span>
            <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
        <span class=p>)</span>
    <span class=p>)</span>
    <span class=c1># annoyingly epoch needs to be not a list to drop duplicates</span>
    <span class=c1># but then we need to sum the epochs into a list</span>
    <span class=n>src_skyrg_df</span><span class=p>[</span><span class=s1>&#39;skyreg_epoch&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>src_skyrg_df</span><span class=p>[</span><span class=s1>&#39;skyreg_epoch&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>[</span><span class=n>x</span><span class=p>,</span> <span class=p>]</span>
    <span class=p>)</span>

    <span class=n>src_skyrg_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>src_skyrg_df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>numeric_only</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>  <span class=c1># sum because we need to preserve order</span>
    <span class=p>)</span>

    <span class=c1># merge into main df and compare the images</span>
    <span class=n>srcs_df</span> <span class=o>=</span> <span class=n>srcs_df</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
        <span class=n>src_skyrg_df</span><span class=p>,</span> <span class=n>left_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>

    <span class=k>del</span> <span class=n>src_skyrg_df</span>

    <span class=n>srcs_df</span><span class=p>[</span><span class=s1>&#39;img_diff&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>srcs_df</span><span class=p>[</span>
        <span class=p>[</span><span class=s1>&#39;img_list&#39;</span><span class=p>,</span> <span class=s1>&#39;skyreg_img_list&#39;</span><span class=p>,</span> <span class=s1>&#39;epoch_list&#39;</span><span class=p>,</span> <span class=s1>&#39;skyreg_epoch&#39;</span><span class=p>]</span>
    <span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=n>get_image_list_diff</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>

    <span class=n>srcs_df</span> <span class=o>=</span> <span class=n>srcs_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
        <span class=n>srcs_df</span><span class=p>[</span><span class=s1>&#39;img_diff&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span>
    <span class=p>]</span>

    <span class=n>srcs_df</span> <span class=o>=</span> <span class=n>srcs_df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span>
        <span class=p>[</span><span class=s1>&#39;epoch_list&#39;</span><span class=p>,</span> <span class=s1>&#39;skyreg_epoch&#39;</span><span class=p>],</span>
        <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>

    <span class=n>srcs_df</span><span class=p>[</span><span class=s1>&#39;primary&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>srcs_df</span><span class=p>[</span>
        <span class=s1>&#39;skyreg_img_list&#39;</span>
    <span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>

    <span class=n>srcs_df</span><span class=p>[</span><span class=s1>&#39;detection&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>srcs_df</span><span class=p>[</span>
        <span class=s1>&#39;img_list&#39;</span>
    <span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>

    <span class=n>srcs_df</span><span class=p>[</span><span class=s1>&#39;in_primary&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>srcs_df</span><span class=p>[</span>
        <span class=p>[</span><span class=s1>&#39;primary&#39;</span><span class=p>,</span> <span class=s1>&#39;img_list&#39;</span><span class=p>]</span>
    <span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=n>check_primary_image</span><span class=p>,</span>
        <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>

    <span class=n>srcs_df</span> <span class=o>=</span> <span class=n>srcs_df</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span><span class=s1>&#39;img_list&#39;</span><span class=p>,</span> <span class=s1>&#39;skyreg_img_list&#39;</span><span class=p>,</span> <span class=s1>&#39;primary&#39;</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
        <span class=s1>&#39;Ideal source coverage time: </span><span class=si>%.2f</span><span class=s1> seconds&#39;</span><span class=p>,</span> <span class=n>merged_timer</span><span class=o>.</span><span class=n>reset</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>srcs_df</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.group_skyregions class="doc doc-heading"> <code class="highlight language-python"><span class=n>group_skyregions</span><span class=p>(</span><span class=n>df</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.group_skyregions class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Logic to group sky regions into overlapping groups. Returns a dataframe containing the sky region id as the index and a column containing a list of the sky region group number it belongs to.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>df</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>A dataframe containing all the sky regions of the run. Only the 'id', 'centre_ra', 'centre_dec' and 'xtr_radius' columns are required. +------+-------------+--------------+--------------+ | id | centre_ra | centre_dec | xtr_radius | |------+-------------+--------------+--------------| | 2 | 319.652 | 0.0030765 | 6.72488 | | 3 | 319.652 | -6.2989 | 6.7401 | | 1 | 21.8361 | -73.121 | 7.24662 | +------+-------------+--------------+--------------+</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The sky region group of each skyregion id. +----+----------------+ | | skyreg_group | |----+----------------| | 2 | 1 | | 3 | 1 | | 1 | 2 | +----+----------------+</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1128</span>
<span class=normal>1129</span>
<span class=normal>1130</span>
<span class=normal>1131</span>
<span class=normal>1132</span>
<span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span>
<span class=normal>1145</span>
<span class=normal>1146</span>
<span class=normal>1147</span>
<span class=normal>1148</span>
<span class=normal>1149</span>
<span class=normal>1150</span>
<span class=normal>1151</span>
<span class=normal>1152</span>
<span class=normal>1153</span>
<span class=normal>1154</span>
<span class=normal>1155</span>
<span class=normal>1156</span>
<span class=normal>1157</span>
<span class=normal>1158</span>
<span class=normal>1159</span>
<span class=normal>1160</span>
<span class=normal>1161</span>
<span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span>
<span class=normal>1173</span>
<span class=normal>1174</span>
<span class=normal>1175</span>
<span class=normal>1176</span>
<span class=normal>1177</span>
<span class=normal>1178</span>
<span class=normal>1179</span>
<span class=normal>1180</span>
<span class=normal>1181</span>
<span class=normal>1182</span>
<span class=normal>1183</span>
<span class=normal>1184</span>
<span class=normal>1185</span>
<span class=normal>1186</span>
<span class=normal>1187</span>
<span class=normal>1188</span>
<span class=normal>1189</span>
<span class=normal>1190</span>
<span class=normal>1191</span>
<span class=normal>1192</span>
<span class=normal>1193</span>
<span class=normal>1194</span>
<span class=normal>1195</span>
<span class=normal>1196</span>
<span class=normal>1197</span>
<span class=normal>1198</span>
<span class=normal>1199</span>
<span class=normal>1200</span>
<span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>group_skyregions</span><span class=p>(</span><span class=n>df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Logic to group sky regions into overlapping groups.</span>
<span class=sd>    Returns a dataframe containing the sky region id as</span>
<span class=sd>    the index and a column containing a list of the</span>
<span class=sd>    sky region group number it belongs to.</span>

<span class=sd>    Args:</span>
<span class=sd>        df:</span>
<span class=sd>            A dataframe containing all the sky regions of the run. Only the</span>
<span class=sd>            &#39;id&#39;, &#39;centre_ra&#39;, &#39;centre_dec&#39; and &#39;xtr_radius&#39; columns are</span>
<span class=sd>            required.</span>
<span class=sd>            +------+-------------+--------------+--------------+</span>
<span class=sd>            |   id |   centre_ra |   centre_dec |   xtr_radius |</span>
<span class=sd>            |------+-------------+--------------+--------------|</span>
<span class=sd>            |    2 |    319.652  |    0.0030765 |      6.72488 |</span>
<span class=sd>            |    3 |    319.652  |   -6.2989    |      6.7401  |</span>
<span class=sd>            |    1 |     21.8361 |  -73.121     |      7.24662 |</span>
<span class=sd>            +------+-------------+--------------+--------------+</span>

<span class=sd>    Returns:</span>
<span class=sd>        The sky region group of each skyregion id.</span>
<span class=sd>            +----+----------------+</span>
<span class=sd>            |    |   skyreg_group |</span>
<span class=sd>            |----+----------------|</span>
<span class=sd>            |  2 |              1 |</span>
<span class=sd>            |  3 |              1 |</span>
<span class=sd>            |  1 |              2 |</span>
<span class=sd>            +----+----------------+</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>sr_coords</span> <span class=o>=</span> <span class=n>SkyCoord</span><span class=p>(</span>
        <span class=n>df</span><span class=p>[</span><span class=s1>&#39;centre_ra&#39;</span><span class=p>],</span>
        <span class=n>df</span><span class=p>[</span><span class=s1>&#39;centre_dec&#39;</span><span class=p>],</span>
        <span class=n>unit</span><span class=o>=</span><span class=p>(</span><span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>,</span> <span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

    <span class=n>results</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=n>_get_skyregion_relations</span><span class=p>,</span>
        <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>sr_coords</span><span class=p>,</span> <span class=n>df</span><span class=o>.</span><span class=n>index</span><span class=p>),</span>
        <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>

    <span class=n>skyreg_groups</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>

    <span class=n>master_done</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># keep track of all checked ids in master done</span>

    <span class=k>for</span> <span class=n>skyreg_id</span><span class=p>,</span> <span class=n>neighbours</span> <span class=ow>in</span> <span class=n>results</span><span class=o>.</span><span class=n>iteritems</span><span class=p>():</span>

        <span class=k>if</span> <span class=n>skyreg_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>master_done</span><span class=p>:</span>
            <span class=n>local_done</span> <span class=o>=</span> <span class=p>[]</span>   <span class=c1># a local done list for the sky region group.</span>
            <span class=c1># add the current skyreg_id to both master and local done.</span>
            <span class=n>master_done</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>skyreg_id</span><span class=p>)</span>
            <span class=n>local_done</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>skyreg_id</span><span class=p>)</span>
            <span class=c1># Define the new group number based on the existing ones.</span>
            <span class=n>skyreg_group</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>skyreg_groups</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
            <span class=c1># Add all the ones that we know are neighbours that were obtained</span>
            <span class=c1># from _get_skyregion_relations.</span>
            <span class=n>skyreg_groups</span><span class=p>[</span><span class=n>skyreg_group</span><span class=p>]</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>neighbours</span><span class=p>)</span>

            <span class=c1># Now the sky region group is extended out to include all those sky</span>
            <span class=c1># regions that overlap with the neighbours.</span>
            <span class=c1># Each neighbour is checked and added to the local done list.</span>
            <span class=c1># Checked means that for each neighbour, it&#39;s own neighbours are</span>
            <span class=c1># added to the current group if not in already.</span>
            <span class=c1># When the local done is equal to the skyreg group we know that</span>
            <span class=c1># we have exhausted all possible neighbours and that results in a</span>
            <span class=c1># sky region group.</span>
            <span class=k>while</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>local_done</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>skyreg_groups</span><span class=p>[</span><span class=n>skyreg_group</span><span class=p>]):</span>
                <span class=c1># Loop over each neighbour</span>
                <span class=k>for</span> <span class=n>other_skyreg_id</span> <span class=ow>in</span> <span class=n>skyreg_groups</span><span class=p>[</span><span class=n>skyreg_group</span><span class=p>]:</span>
                    <span class=c1># If we haven&#39;t checked this neighbour locally proceed.</span>
                    <span class=k>if</span> <span class=n>other_skyreg_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>local_done</span><span class=p>:</span>
                        <span class=c1># Add it to the local checked.</span>
                        <span class=n>local_done</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>other_skyreg_id</span><span class=p>)</span>
                        <span class=c1># Get the neighbours neighbour and add these.</span>
                        <span class=n>new_vals</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>other_skyreg_id</span><span class=p>]</span>
                        <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=n>new_vals</span><span class=p>:</span>
                            <span class=k>if</span> <span class=n>k</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>skyreg_groups</span><span class=p>[</span><span class=n>skyreg_group</span><span class=p>]:</span>
                                <span class=n>skyreg_groups</span><span class=p>[</span><span class=n>skyreg_group</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>k</span><span class=p>)</span>

            <span class=c1># Reached the end of the group so append all to the master</span>
            <span class=c1># done list</span>
            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>skyreg_groups</span><span class=p>[</span><span class=n>skyreg_group</span><span class=p>]:</span>
                <span class=n>master_done</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>j</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=c1># continue if already placed in group</span>
            <span class=k>continue</span>

    <span class=c1># flip the dictionary around</span>
    <span class=n>skyreg_group_ids</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>skyreg_groups</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>skyreg_groups</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
            <span class=n>skyreg_group_ids</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span>

    <span class=n>skyreg_group_ids</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span>
        <span class=n>skyreg_group_ids</span><span class=p>,</span> <span class=n>orient</span><span class=o>=</span><span class=s1>&#39;index&#39;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>:</span> <span class=s1>&#39;skyreg_group&#39;</span><span class=p>})</span>

    <span class=k>return</span> <span class=n>skyreg_group_ids</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.groupby_funcs class="doc doc-heading"> <code class="highlight language-python"><span class=n>groupby_funcs</span><span class=p>(</span><span class=n>df</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.groupby_funcs class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Performs calculations on the unique sources to get the lightcurve properties. Works on the grouped by source dataframe.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>df</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The current iteration dataframe of the grouped by sources dataframe.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code> </td> <td><p>Pandas series containing the calculated metrics of the source.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span>
<span class=normal>635</span>
<span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span>
<span class=normal>657</span>
<span class=normal>658</span>
<span class=normal>659</span>
<span class=normal>660</span>
<span class=normal>661</span>
<span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>groupby_funcs</span><span class=p>(</span><span class=n>df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>:</span>
    <span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Performs calculations on the unique sources to get the</span>
<span class=sd>    lightcurve properties. Works on the grouped by source</span>
<span class=sd>    dataframe.</span>

<span class=sd>    Args:</span>
<span class=sd>        df: The current iteration dataframe of the grouped by sources</span>
<span class=sd>            dataframe.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Pandas series containing the calculated metrics of the source.</span>
<span class=sd>    &#39;&#39;&#39;</span>
    <span class=c1># calculated average ra, dec, fluxes and metrics</span>
    <span class=n>d</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;img_list&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;image&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;n_meas_forced&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;forced&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;n_meas&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;n_meas_sel&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=s1>&#39;n_meas&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>d</span><span class=p>[</span><span class=s1>&#39;n_meas_forced&#39;</span><span class=p>]</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;n_sibl&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;has_siblings&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>d</span><span class=p>[</span><span class=s1>&#39;n_meas_forced&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>non_forced_sel</span> <span class=o>=</span> <span class=o>~</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;forced&#39;</span><span class=p>]</span>
        <span class=n>d</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>non_forced_sel</span><span class=p>,</span> <span class=s1>&#39;interim_ew&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span> <span class=o>/</span>
            <span class=n>df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>non_forced_sel</span><span class=p>,</span> <span class=s1>&#39;weight_ew&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
        <span class=p>)</span>
        <span class=n>d</span><span class=p>[</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>non_forced_sel</span><span class=p>,</span> <span class=s1>&#39;interim_ns&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span> <span class=o>/</span>
            <span class=n>df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>non_forced_sel</span><span class=p>,</span> <span class=s1>&#39;weight_ns&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
        <span class=p>)</span>
        <span class=n>d</span><span class=p>[</span><span class=s1>&#39;avg_compactness&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=n>non_forced_sel</span><span class=p>,</span> <span class=s1>&#39;compactness&#39;</span>
        <span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
        <span class=n>d</span><span class=p>[</span><span class=s1>&#39;min_snr&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=n>non_forced_sel</span><span class=p>,</span> <span class=s1>&#39;snr&#39;</span>
        <span class=p>]</span><span class=o>.</span><span class=n>min</span><span class=p>()</span>
        <span class=n>d</span><span class=p>[</span><span class=s1>&#39;max_snr&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
            <span class=n>non_forced_sel</span><span class=p>,</span> <span class=s1>&#39;snr&#39;</span>
        <span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>d</span><span class=p>[</span><span class=s1>&#39;wavg_ra&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;interim_ew&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;weight_ew&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
        <span class=n>d</span><span class=p>[</span><span class=s1>&#39;wavg_dec&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;interim_ns&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;weight_ns&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
        <span class=n>d</span><span class=p>[</span><span class=s1>&#39;avg_compactness&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;compactness&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
        <span class=n>d</span><span class=p>[</span><span class=s1>&#39;min_snr&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;snr&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>min</span><span class=p>()</span>
        <span class=n>d</span><span class=p>[</span><span class=s1>&#39;max_snr&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;snr&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>

    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;wavg_uncertainty_ew&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mf>1.</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;weight_ew&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>())</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;wavg_uncertainty_ns&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mf>1.</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;weight_ns&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>())</span>
    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;avg_flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>]:</span>
        <span class=n>d</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>col</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;_&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;max_flux_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;max_flux_int&#39;</span><span class=p>]:</span>
        <span class=n>d</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>col</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;_&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]]</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>
    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;min_flux_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;min_flux_int&#39;</span><span class=p>]:</span>
        <span class=n>d</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>col</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;_&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]]</span><span class=o>.</span><span class=n>min</span><span class=p>()</span>
    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;min_flux_peak_isl_ratio&#39;</span><span class=p>,</span> <span class=s1>&#39;min_flux_int_isl_ratio&#39;</span><span class=p>]:</span>
        <span class=n>d</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>col</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;_&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]]</span><span class=o>.</span><span class=n>min</span><span class=p>()</span>

    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak&#39;</span><span class=p>]:</span>
        <span class=n>d</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>col</span><span class=si>}</span><span class=s1>_sq&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>col</span><span class=p>]</span><span class=o>**</span><span class=mi>2</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;v_int&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;flux_int&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>std</span><span class=p>()</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;flux_int&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;v_peak&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>std</span><span class=p>()</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;flux_peak&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;eta_int&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>get_eta_metric</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=n>df</span><span class=p>)</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;eta_peak&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>get_eta_metric</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=n>df</span><span class=p>,</span> <span class=n>peak</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=c1># remove not used cols</span>
    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;flux_int_sq&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak_sq&#39;</span><span class=p>]:</span>
        <span class=n>d</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>col</span><span class=p>)</span>

    <span class=c1># get unique related sources</span>
    <span class=n>list_uniq_related</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span>
        <span class=n>chain</span><span class=o>.</span><span class=n>from_iterable</span><span class=p>(</span>
            <span class=n>lst</span> <span class=k>for</span> <span class=n>lst</span> <span class=ow>in</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;related&#39;</span><span class=p>]</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>lst</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span>
        <span class=p>)</span>
    <span class=p>))</span>
    <span class=n>d</span><span class=p>[</span><span class=s1>&#39;related_list&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>list_uniq_related</span> <span class=k>if</span> <span class=n>list_uniq_related</span> <span class=k>else</span> <span class=o>-</span><span class=mi>1</span>

    <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>d</span><span class=p>)</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>value</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;v_int&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span> <span class=s2>&quot;v_peak&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>})</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.parallel_groupby class="doc doc-heading"> <code class="highlight language-python"><span class=n>parallel_groupby</span><span class=p>(</span><span class=n>df</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.parallel_groupby class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Performs the parallel source dataframe operations to calculate the source metrics using Dask and returns the resulting dataframe.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>df</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The sources dataframe produced by the previous pipeline stages.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The source dataframe with the calculated metric columns.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>668</span>
<span class=normal>669</span>
<span class=normal>670</span>
<span class=normal>671</span>
<span class=normal>672</span>
<span class=normal>673</span>
<span class=normal>674</span>
<span class=normal>675</span>
<span class=normal>676</span>
<span class=normal>677</span>
<span class=normal>678</span>
<span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span>
<span class=normal>686</span>
<span class=normal>687</span>
<span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span>
<span class=normal>715</span>
<span class=normal>716</span>
<span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>parallel_groupby</span><span class=p>(</span><span class=n>df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Performs the parallel source dataframe operations to calculate the source</span>
<span class=sd>    metrics using Dask and returns the resulting dataframe.</span>

<span class=sd>    Args:</span>
<span class=sd>        df: The sources dataframe produced by the previous pipeline stages.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The source dataframe with the calculated metric columns.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>col_dtype</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;img_list&#39;</span><span class=p>:</span> <span class=s1>&#39;O&#39;</span><span class=p>,</span>
        <span class=s1>&#39;n_meas_forced&#39;</span><span class=p>:</span> <span class=s1>&#39;i&#39;</span><span class=p>,</span>
        <span class=s1>&#39;n_meas&#39;</span><span class=p>:</span> <span class=s1>&#39;i&#39;</span><span class=p>,</span>
        <span class=s1>&#39;n_meas_sel&#39;</span><span class=p>:</span> <span class=s1>&#39;i&#39;</span><span class=p>,</span>
        <span class=s1>&#39;n_sibl&#39;</span><span class=p>:</span> <span class=s1>&#39;i&#39;</span><span class=p>,</span>
        <span class=s1>&#39;wavg_ra&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;wavg_dec&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;avg_compactness&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;min_snr&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;max_snr&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;wavg_uncertainty_ew&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;wavg_uncertainty_ns&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;avg_flux_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;avg_flux_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;max_flux_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;max_flux_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;min_flux_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;min_flux_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;min_flux_peak_isl_ratio&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;min_flux_int_isl_ratio&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;v_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;v_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;eta_int&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;eta_peak&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;related_list&#39;</span><span class=p>:</span> <span class=s1>&#39;O&#39;</span>
    <span class=p>}</span>
    <span class=n>n_cpu</span> <span class=o>=</span> <span class=n>cpu_count</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
    <span class=n>out</span> <span class=o>=</span> <span class=n>dd</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>n_cpu</span><span class=p>)</span>
    <span class=n>out</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>out</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>apply</span><span class=p>(</span>
            <span class=n>groupby_funcs</span><span class=p>,</span>
            <span class=n>meta</span><span class=o>=</span><span class=n>col_dtype</span>
        <span class=p>)</span>
        <span class=o>.</span><span class=n>compute</span><span class=p>(</span><span class=n>num_workers</span><span class=o>=</span><span class=n>n_cpu</span><span class=p>,</span> <span class=n>scheduler</span><span class=o>=</span><span class=s1>&#39;processes&#39;</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=n>out</span><span class=p>[</span><span class=s1>&#39;n_rel&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>out</span><span class=p>[</span><span class=s1>&#39;related_list&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=mi>0</span> <span class=k>if</span> <span class=n>x</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=k>else</span> <span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>

    <span class=k>return</span> <span class=n>out</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.parallel_groupby_coord class="doc doc-heading"> <code class="highlight language-python"><span class=n>parallel_groupby_coord</span><span class=p>(</span><span class=n>df</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.parallel_groupby_coord class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>This function uses Dask to perform the average coordinate and unique image and epoch lists calculation. The result from the Dask compute is returned which is a dataframe containing the results for each source.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>df</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The sources dataframe produced by the pipeline.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The resulting average coordinate values and unique image and epoch lists for each unique source (group).</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>746</span>
<span class=normal>747</span>
<span class=normal>748</span>
<span class=normal>749</span>
<span class=normal>750</span>
<span class=normal>751</span>
<span class=normal>752</span>
<span class=normal>753</span>
<span class=normal>754</span>
<span class=normal>755</span>
<span class=normal>756</span>
<span class=normal>757</span>
<span class=normal>758</span>
<span class=normal>759</span>
<span class=normal>760</span>
<span class=normal>761</span>
<span class=normal>762</span>
<span class=normal>763</span>
<span class=normal>764</span>
<span class=normal>765</span>
<span class=normal>766</span>
<span class=normal>767</span>
<span class=normal>768</span>
<span class=normal>769</span>
<span class=normal>770</span>
<span class=normal>771</span>
<span class=normal>772</span>
<span class=normal>773</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>parallel_groupby_coord</span><span class=p>(</span><span class=n>df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    This function uses Dask to perform the average coordinate and unique image</span>
<span class=sd>    and epoch lists calculation. The result from the Dask compute is returned</span>
<span class=sd>    which is a dataframe containing the results for each source.</span>

<span class=sd>    Args:</span>
<span class=sd>        df: The sources dataframe produced by the pipeline.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The resulting average coordinate values and unique image and epoch</span>
<span class=sd>            lists for each unique source (group).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>col_dtype</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;img_list&#39;</span><span class=p>:</span> <span class=s1>&#39;O&#39;</span><span class=p>,</span>
        <span class=s1>&#39;epoch_list&#39;</span><span class=p>:</span> <span class=s1>&#39;O&#39;</span><span class=p>,</span>
        <span class=s1>&#39;wavg_ra&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
        <span class=s1>&#39;wavg_dec&#39;</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span>
    <span class=p>}</span>
    <span class=n>n_cpu</span> <span class=o>=</span> <span class=n>cpu_count</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
    <span class=n>out</span> <span class=o>=</span> <span class=n>dd</span><span class=o>.</span><span class=n>from_pandas</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>n_cpu</span><span class=p>)</span>
    <span class=n>out</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>out</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>calc_ave_coord</span><span class=p>,</span> <span class=n>meta</span><span class=o>=</span><span class=n>col_dtype</span><span class=p>)</span>
        <span class=o>.</span><span class=n>compute</span><span class=p>(</span><span class=n>num_workers</span><span class=o>=</span><span class=n>n_cpu</span><span class=p>,</span> <span class=n>scheduler</span><span class=o>=</span><span class=s1>&#39;processes&#39;</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>out</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.prep_skysrc_df class="doc doc-heading"> <code class="highlight language-python"><span class=n>prep_skysrc_df</span><span class=p>(</span><span class=n>images</span><span class=p>,</span> <span class=n>perc_error</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>duplicate_limit</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ini_df</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.prep_skysrc_df class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Initialise the source dataframe to use in association logic by reading the measurement parquet file and creating columns. When epoch based association is used it will also remove duplicate measurements from the list of sources.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>images</code></td> <td> <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="vast_pipeline.models.Image" href="../../models/#vast_pipeline.models.Image">Image</a>]</code> </td> <td><p>A list holding the Image objects of the images to load measurements for.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>perc_error</code></td> <td> <code>float</code> </td> <td><p>A percentage flux error to apply to the flux errors of the measurements. Defaults to 0.</p></td> <td> <code>0.0</code> </td> </tr> <tr> <td><code>duplicate_limit</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="astropy.coordinates.Angle">Angle</span>]</code> </td> <td><p>The separation limit of when a source is considered a duplicate. Defaults to None in which case 2.5 arcsec is used in the 'remove_duplicate_measurements' function (usual ASKAP pixel size).</p></td> <td> <code>None</code> </td> </tr> <tr> <td><code>ini_df</code></td> <td> <code>bool</code> </td> <td><p>Boolean to indicate whether these sources are part of the initial source list creation for association. If 'True' the source ids are reset ready for the first iteration. Defaults to 'False'.</p></td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The measurements of the image(s) with some extra values set ready for association and duplicates removed if necessary.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>prep_skysrc_df</span><span class=p>(</span>
    <span class=n>images</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Image</span><span class=p>],</span>
    <span class=n>perc_error</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.</span><span class=p>,</span>
    <span class=n>duplicate_limit</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Angle</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>ini_df</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Initialise the source dataframe to use in association logic by</span>
<span class=sd>    reading the measurement parquet file and creating columns. When epoch</span>
<span class=sd>    based association is used it will also remove duplicate measurements from</span>
<span class=sd>    the list of sources.</span>

<span class=sd>    Args:</span>
<span class=sd>        images:</span>
<span class=sd>            A list holding the Image objects of the images to load measurements</span>
<span class=sd>            for.</span>
<span class=sd>        perc_error:</span>
<span class=sd>            A percentage flux error to apply to the flux errors of the</span>
<span class=sd>            measurements. Defaults to 0.</span>
<span class=sd>        duplicate_limit:</span>
<span class=sd>            The separation limit of when a source is considered a duplicate.</span>
<span class=sd>            Defaults to None in which case 2.5 arcsec is used in the</span>
<span class=sd>            &#39;remove_duplicate_measurements&#39; function (usual ASKAP pixel size).</span>
<span class=sd>        ini_df:</span>
<span class=sd>            Boolean to indicate whether these sources are part of the initial</span>
<span class=sd>            source list creation for association. If &#39;True&#39; the source ids are</span>
<span class=sd>            reset ready for the first iteration. Defaults to &#39;False&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The measurements of the image(s) with some extra values set ready for</span>
<span class=sd>            association and duplicates removed if necessary.</span>
<span class=sd>    &#39;&#39;&#39;</span>
    <span class=n>cols</span> <span class=o>=</span> <span class=p>[</span>
        <span class=s1>&#39;id&#39;</span><span class=p>,</span>
        <span class=s1>&#39;ra&#39;</span><span class=p>,</span>
        <span class=s1>&#39;uncertainty_ew&#39;</span><span class=p>,</span>
        <span class=s1>&#39;weight_ew&#39;</span><span class=p>,</span>
        <span class=s1>&#39;dec&#39;</span><span class=p>,</span>
        <span class=s1>&#39;uncertainty_ns&#39;</span><span class=p>,</span>
        <span class=s1>&#39;weight_ns&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_int&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_int_err&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_int_isl_ratio&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_peak&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_peak_err&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_peak_isl_ratio&#39;</span><span class=p>,</span>
        <span class=s1>&#39;forced&#39;</span><span class=p>,</span>
        <span class=s1>&#39;compactness&#39;</span><span class=p>,</span>
        <span class=s1>&#39;has_siblings&#39;</span><span class=p>,</span>
        <span class=s1>&#39;snr&#39;</span>
    <span class=p>]</span>

    <span class=n>df</span> <span class=o>=</span> <span class=n>_load_measurements</span><span class=p>(</span><span class=n>images</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cols</span><span class=p>,</span> <span class=n>ini_df</span><span class=o>=</span><span class=n>ini_df</span><span class=p>)</span>

    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>images</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>img</span> <span class=ow>in</span> <span class=n>images</span><span class=p>[</span><span class=mi>1</span><span class=p>:]:</span>
            <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
                <span class=p>[</span>
                    <span class=n>df</span><span class=p>,</span>
                    <span class=n>_load_measurements</span><span class=p>(</span>
                        <span class=n>img</span><span class=p>,</span> <span class=n>cols</span><span class=p>,</span> <span class=n>df</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>max</span><span class=p>(),</span> <span class=n>ini_df</span><span class=o>=</span><span class=n>ini_df</span>
                    <span class=p>)</span>
                <span class=p>],</span>
                <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>

        <span class=n>df</span> <span class=o>=</span> <span class=n>remove_duplicate_measurements</span><span class=p>(</span>
            <span class=n>df</span><span class=p>,</span> <span class=n>dup_lim</span><span class=o>=</span><span class=n>duplicate_limit</span><span class=p>,</span> <span class=n>ini_df</span><span class=o>=</span><span class=n>ini_df</span>
        <span class=p>)</span>

    <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;dist_from_centre&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>perc_error</span> <span class=o>!=</span> <span class=mf>0.0</span><span class=p>:</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Correcting flux errors with config error setting...&#39;</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak&#39;</span><span class=p>]:</span>
            <span class=n>df</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>col</span><span class=si>}</span><span class=s1>_err&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>hypot</span><span class=p>(</span>
                <span class=n>df</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>col</span><span class=si>}</span><span class=s1>_err&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>perc_error</span> <span class=o>*</span> <span class=n>df</span><span class=p>[</span><span class=n>col</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
            <span class=p>)</span>

    <span class=k>return</span> <span class=n>df</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.reconstruct_associtaion_dfs class="doc doc-heading"> <code class="highlight language-python"><span class=n>reconstruct_associtaion_dfs</span><span class=p>(</span><span class=n>images_df_done</span><span class=p>,</span> <span class=n>previous_parquet_paths</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.reconstruct_associtaion_dfs class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>This function is used with add image mode and performs the necessary manipulations to reconstruct the sources_df and skyc1_srcs required by association.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>images_df_done</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The images_df output from the existing run (from the parquet).</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>previous_parquet_paths</code></td> <td> <code><span title="typing.Dict">Dict</span>[str, str]</code> </td> <td><p>Dictionary that contains the paths for the previous run parquet files. Keys are 'images', 'associations', 'sources', 'relations' and 'measurement_pairs'.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The reconstructed <code>sources_df</code> dataframe.</p></td> </tr> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The reconstructed <code>skyc1_srs</code> dataframes.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1449</span>
<span class=normal>1450</span>
<span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span>
<span class=normal>1459</span>
<span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span>
<span class=normal>1471</span>
<span class=normal>1472</span>
<span class=normal>1473</span>
<span class=normal>1474</span>
<span class=normal>1475</span>
<span class=normal>1476</span>
<span class=normal>1477</span>
<span class=normal>1478</span>
<span class=normal>1479</span>
<span class=normal>1480</span>
<span class=normal>1481</span>
<span class=normal>1482</span>
<span class=normal>1483</span>
<span class=normal>1484</span>
<span class=normal>1485</span>
<span class=normal>1486</span>
<span class=normal>1487</span>
<span class=normal>1488</span>
<span class=normal>1489</span>
<span class=normal>1490</span>
<span class=normal>1491</span>
<span class=normal>1492</span>
<span class=normal>1493</span>
<span class=normal>1494</span>
<span class=normal>1495</span>
<span class=normal>1496</span>
<span class=normal>1497</span>
<span class=normal>1498</span>
<span class=normal>1499</span>
<span class=normal>1500</span>
<span class=normal>1501</span>
<span class=normal>1502</span>
<span class=normal>1503</span>
<span class=normal>1504</span>
<span class=normal>1505</span>
<span class=normal>1506</span>
<span class=normal>1507</span>
<span class=normal>1508</span>
<span class=normal>1509</span>
<span class=normal>1510</span>
<span class=normal>1511</span>
<span class=normal>1512</span>
<span class=normal>1513</span>
<span class=normal>1514</span>
<span class=normal>1515</span>
<span class=normal>1516</span>
<span class=normal>1517</span>
<span class=normal>1518</span>
<span class=normal>1519</span>
<span class=normal>1520</span>
<span class=normal>1521</span>
<span class=normal>1522</span>
<span class=normal>1523</span>
<span class=normal>1524</span>
<span class=normal>1525</span>
<span class=normal>1526</span>
<span class=normal>1527</span>
<span class=normal>1528</span>
<span class=normal>1529</span>
<span class=normal>1530</span>
<span class=normal>1531</span>
<span class=normal>1532</span>
<span class=normal>1533</span>
<span class=normal>1534</span>
<span class=normal>1535</span>
<span class=normal>1536</span>
<span class=normal>1537</span>
<span class=normal>1538</span>
<span class=normal>1539</span>
<span class=normal>1540</span>
<span class=normal>1541</span>
<span class=normal>1542</span>
<span class=normal>1543</span>
<span class=normal>1544</span>
<span class=normal>1545</span>
<span class=normal>1546</span>
<span class=normal>1547</span>
<span class=normal>1548</span>
<span class=normal>1549</span>
<span class=normal>1550</span>
<span class=normal>1551</span>
<span class=normal>1552</span>
<span class=normal>1553</span>
<span class=normal>1554</span>
<span class=normal>1555</span>
<span class=normal>1556</span>
<span class=normal>1557</span>
<span class=normal>1558</span>
<span class=normal>1559</span>
<span class=normal>1560</span>
<span class=normal>1561</span>
<span class=normal>1562</span>
<span class=normal>1563</span>
<span class=normal>1564</span>
<span class=normal>1565</span>
<span class=normal>1566</span>
<span class=normal>1567</span>
<span class=normal>1568</span>
<span class=normal>1569</span>
<span class=normal>1570</span>
<span class=normal>1571</span>
<span class=normal>1572</span>
<span class=normal>1573</span>
<span class=normal>1574</span>
<span class=normal>1575</span>
<span class=normal>1576</span>
<span class=normal>1577</span>
<span class=normal>1578</span>
<span class=normal>1579</span>
<span class=normal>1580</span>
<span class=normal>1581</span>
<span class=normal>1582</span>
<span class=normal>1583</span>
<span class=normal>1584</span>
<span class=normal>1585</span>
<span class=normal>1586</span>
<span class=normal>1587</span>
<span class=normal>1588</span>
<span class=normal>1589</span>
<span class=normal>1590</span>
<span class=normal>1591</span>
<span class=normal>1592</span>
<span class=normal>1593</span>
<span class=normal>1594</span>
<span class=normal>1595</span>
<span class=normal>1596</span>
<span class=normal>1597</span>
<span class=normal>1598</span>
<span class=normal>1599</span>
<span class=normal>1600</span>
<span class=normal>1601</span>
<span class=normal>1602</span>
<span class=normal>1603</span>
<span class=normal>1604</span>
<span class=normal>1605</span>
<span class=normal>1606</span>
<span class=normal>1607</span>
<span class=normal>1608</span>
<span class=normal>1609</span>
<span class=normal>1610</span>
<span class=normal>1611</span>
<span class=normal>1612</span>
<span class=normal>1613</span>
<span class=normal>1614</span>
<span class=normal>1615</span>
<span class=normal>1616</span>
<span class=normal>1617</span>
<span class=normal>1618</span>
<span class=normal>1619</span>
<span class=normal>1620</span>
<span class=normal>1621</span>
<span class=normal>1622</span>
<span class=normal>1623</span>
<span class=normal>1624</span>
<span class=normal>1625</span>
<span class=normal>1626</span>
<span class=normal>1627</span>
<span class=normal>1628</span>
<span class=normal>1629</span>
<span class=normal>1630</span>
<span class=normal>1631</span>
<span class=normal>1632</span>
<span class=normal>1633</span>
<span class=normal>1634</span>
<span class=normal>1635</span>
<span class=normal>1636</span>
<span class=normal>1637</span>
<span class=normal>1638</span>
<span class=normal>1639</span>
<span class=normal>1640</span>
<span class=normal>1641</span>
<span class=normal>1642</span>
<span class=normal>1643</span>
<span class=normal>1644</span>
<span class=normal>1645</span>
<span class=normal>1646</span>
<span class=normal>1647</span>
<span class=normal>1648</span>
<span class=normal>1649</span>
<span class=normal>1650</span>
<span class=normal>1651</span>
<span class=normal>1652</span>
<span class=normal>1653</span>
<span class=normal>1654</span>
<span class=normal>1655</span>
<span class=normal>1656</span>
<span class=normal>1657</span>
<span class=normal>1658</span>
<span class=normal>1659</span>
<span class=normal>1660</span>
<span class=normal>1661</span>
<span class=normal>1662</span>
<span class=normal>1663</span>
<span class=normal>1664</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>reconstruct_associtaion_dfs</span><span class=p>(</span>
    <span class=n>images_df_done</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>previous_parquet_paths</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    This function is used with add image mode and performs the necessary</span>
<span class=sd>    manipulations to reconstruct the sources_df and skyc1_srcs required by</span>
<span class=sd>    association.</span>

<span class=sd>    Args:</span>
<span class=sd>        images_df_done:</span>
<span class=sd>            The images_df output from the existing run (from the parquet).</span>
<span class=sd>        previous_parquet_paths:</span>
<span class=sd>            Dictionary that contains the paths for the previous run parquet</span>
<span class=sd>            files. Keys are &#39;images&#39;, &#39;associations&#39;, &#39;sources&#39;, &#39;relations&#39;</span>
<span class=sd>            and &#39;measurement_pairs&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The reconstructed `sources_df` dataframe.</span>
<span class=sd>        The reconstructed `skyc1_srs` dataframes.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>prev_associations</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=n>previous_parquet_paths</span><span class=p>[</span><span class=s1>&#39;associations&#39;</span><span class=p>])</span>

    <span class=c1># Get the parquet paths from the image objects</span>
    <span class=n>img_meas_paths</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>images_df_done</span><span class=p>[</span><span class=s1>&#39;image_dj&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>measurements_path</span><span class=p>)</span>
        <span class=o>.</span><span class=n>to_list</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=c1># Obtain the pipeline run path in order to fetch forced measurements.</span>
    <span class=n>run_path</span> <span class=o>=</span> <span class=n>previous_parquet_paths</span><span class=p>[</span><span class=s1>&#39;sources&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span>
        <span class=s1>&#39;sources.parquet.bak&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span>
    <span class=p>)</span>

    <span class=c1># Get the forced measurement paths.</span>
    <span class=n>img_fmeas_paths</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>images_df_done</span><span class=o>.</span><span class=n>image_name</span><span class=o>.</span><span class=n>values</span><span class=p>:</span>
        <span class=n>forced_parquet</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>run_path</span><span class=p>,</span> <span class=s2>&quot;forced_measurements_</span><span class=si>{}</span><span class=s2>.parquet&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>i</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>,</span> <span class=s2>&quot;_&quot;</span><span class=p>)</span>
            <span class=p>)</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>forced_parquet</span><span class=p>):</span>
            <span class=n>img_fmeas_paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>forced_parquet</span><span class=p>)</span>

    <span class=c1># Create union of paths.</span>
    <span class=n>img_meas_paths</span> <span class=o>+=</span> <span class=n>img_fmeas_paths</span>

    <span class=c1># Define the columns that are required</span>
    <span class=n>cols</span> <span class=o>=</span> <span class=p>[</span>
        <span class=s1>&#39;id&#39;</span><span class=p>,</span>
        <span class=s1>&#39;ra&#39;</span><span class=p>,</span>
        <span class=s1>&#39;uncertainty_ew&#39;</span><span class=p>,</span>
        <span class=s1>&#39;weight_ew&#39;</span><span class=p>,</span>
        <span class=s1>&#39;dec&#39;</span><span class=p>,</span>
        <span class=s1>&#39;uncertainty_ns&#39;</span><span class=p>,</span>
        <span class=s1>&#39;weight_ns&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_int&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_int_err&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_int_isl_ratio&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_peak&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_peak_err&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_peak_isl_ratio&#39;</span><span class=p>,</span>
        <span class=s1>&#39;forced&#39;</span><span class=p>,</span>
        <span class=s1>&#39;compactness&#39;</span><span class=p>,</span>
        <span class=s1>&#39;has_siblings&#39;</span><span class=p>,</span>
        <span class=s1>&#39;snr&#39;</span><span class=p>,</span>
        <span class=s1>&#39;image_id&#39;</span><span class=p>,</span>
        <span class=s1>&#39;time&#39;</span><span class=p>,</span>
    <span class=p>]</span>

    <span class=c1># Open all the parquets</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
        <span class=s2>&quot;Opening all measurement parquet files to use in reconstruction...&quot;</span>
    <span class=p>)</span>
    <span class=n>measurements</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
        <span class=p>[</span><span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=n>cols</span><span class=p>)</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>img_meas_paths</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=c1># Create mask to drop measurements for epoch mode (epoch based mode).</span>
    <span class=n>measurements_mask</span> <span class=o>=</span> <span class=n>measurements</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
        <span class=n>prev_associations</span><span class=p>[</span><span class=s1>&#39;meas_id&#39;</span><span class=p>])</span>
    <span class=n>measurements</span> <span class=o>=</span> <span class=n>measurements</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>measurements_mask</span><span class=p>]</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>

    <span class=c1># Set the index on images_df for faster merging.</span>
    <span class=n>images_df_done</span><span class=p>[</span><span class=s1>&#39;image_id&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>images_df_done</span><span class=p>[</span><span class=s1>&#39;image_dj&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
        <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>id</span><span class=p>)</span><span class=o>.</span><span class=n>values</span>
    <span class=n>images_df_done</span> <span class=o>=</span> <span class=n>images_df_done</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;image_id&#39;</span><span class=p>)</span>

    <span class=c1># Merge image information to measurements</span>
    <span class=n>measurements</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>measurements</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=n>images_df_done</span><span class=p>[[</span><span class=s1>&#39;image_name&#39;</span><span class=p>,</span> <span class=s1>&#39;epoch&#39;</span><span class=p>]],</span>
            <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;image_id&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span>
        <span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;image_name&#39;</span><span class=p>:</span> <span class=s1>&#39;image&#39;</span><span class=p>})</span>
    <span class=p>)</span>

    <span class=c1># Drop any associations that are not used in this sky region group.</span>
    <span class=n>associations_mask</span> <span class=o>=</span> <span class=n>prev_associations</span><span class=p>[</span><span class=s1>&#39;meas_id&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span>
        <span class=n>measurements</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)</span>

    <span class=n>prev_associations</span> <span class=o>=</span> <span class=n>prev_associations</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>associations_mask</span><span class=p>]</span>

    <span class=c1># Merge measurements into the associations to form the sources_df.</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>prev_associations</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=n>measurements</span><span class=p>,</span> <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;meas_id&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span>
        <span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;source_id&#39;</span><span class=p>:</span> <span class=s1>&#39;source&#39;</span><span class=p>,</span> <span class=s1>&#39;time&#39;</span><span class=p>:</span> <span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=s1>&#39;meas_id&#39;</span><span class=p>:</span> <span class=s1>&#39;id&#39;</span><span class=p>,</span>
            <span class=s1>&#39;ra&#39;</span><span class=p>:</span> <span class=s1>&#39;ra_source&#39;</span><span class=p>,</span> <span class=s1>&#39;dec&#39;</span><span class=p>:</span> <span class=s1>&#39;dec_source&#39;</span><span class=p>,</span>
            <span class=s1>&#39;uncertainty_ew&#39;</span><span class=p>:</span> <span class=s1>&#39;uncertainty_ew_source&#39;</span><span class=p>,</span>
            <span class=s1>&#39;uncertainty_ns&#39;</span><span class=p>:</span> <span class=s1>&#39;uncertainty_ns_source&#39;</span><span class=p>,</span>
        <span class=p>})</span>
    <span class=p>)</span>

    <span class=c1># Load up the previous unique sources.</span>
    <span class=n>prev_sources</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span>
        <span class=n>previous_parquet_paths</span><span class=p>[</span><span class=s1>&#39;sources&#39;</span><span class=p>],</span> <span class=n>columns</span><span class=o>=</span><span class=p>[</span>
            <span class=s1>&#39;wavg_ra&#39;</span><span class=p>,</span> <span class=s1>&#39;wavg_dec&#39;</span><span class=p>,</span>
            <span class=s1>&#39;wavg_uncertainty_ew&#39;</span><span class=p>,</span> <span class=s1>&#39;wavg_uncertainty_ns&#39;</span><span class=p>,</span>
        <span class=p>]</span>
    <span class=p>)</span>

    <span class=c1># Merge the wavg ra and dec to the sources_df - this is required to</span>
    <span class=c1># create the skyc1_srcs below (but MUST be converted back to the source</span>
    <span class=c1># ra and dec)</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>sources_df</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
            <span class=n>prev_sources</span><span class=p>,</span> <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;source&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;wavg_ra&#39;</span><span class=p>:</span> <span class=s1>&#39;ra&#39;</span><span class=p>,</span> <span class=s1>&#39;wavg_dec&#39;</span><span class=p>:</span> <span class=s1>&#39;dec&#39;</span><span class=p>,</span>
            <span class=s1>&#39;wavg_uncertainty_ew&#39;</span><span class=p>:</span> <span class=s1>&#39;uncertainty_ew&#39;</span><span class=p>,</span>
            <span class=s1>&#39;wavg_uncertainty_ns&#39;</span><span class=p>:</span> <span class=s1>&#39;uncertainty_ns&#39;</span><span class=p>,</span>
        <span class=p>})</span>
    <span class=p>)</span>

    <span class=c1># Load the previous relations</span>
    <span class=n>prev_relations</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=n>previous_parquet_paths</span><span class=p>[</span><span class=s1>&#39;relations&#39;</span><span class=p>])</span>

    <span class=c1># Form relation lists to merge in.</span>
    <span class=n>prev_relations</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
        <span class=n>prev_relations</span>
        <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;from_source_id&#39;</span><span class=p>)[</span><span class=s1>&#39;to_source_id&#39;</span><span class=p>]</span>
        <span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>tolist</span><span class=p>())</span>
    <span class=p>)</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;to_source_id&#39;</span><span class=p>:</span> <span class=s1>&#39;related&#39;</span><span class=p>})</span>

    <span class=c1># Append the relations to only the last instance of each source</span>
    <span class=c1># First get the ids of the sources</span>
    <span class=n>relation_ids</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span>
        <span class=n>sources_df</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>prev_relations</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span><span class=p>)]</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span>
            <span class=s1>&#39;source&#39;</span><span class=p>,</span> <span class=n>keep</span><span class=o>=</span><span class=s1>&#39;last&#39;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>
    <span class=c1># Make sure we attach the correct source id</span>
    <span class=n>source_ids</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>relation_ids</span><span class=p>]</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>values</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;related&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
    <span class=n>relations_to_update</span> <span class=o>=</span> <span class=n>prev_relations</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>source_ids</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
    <span class=n>relations_to_update</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span>
        <span class=n>relations_to_update</span><span class=p>,</span> <span class=n>relations_to_update</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
    <span class=n>sources_df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>relation_ids</span><span class=p>,</span> <span class=s1>&#39;related&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>relations_to_update</span>

    <span class=c1># Reorder so we don&#39;t mess up the dask metas.</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[[</span>
        <span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;uncertainty_ew&#39;</span><span class=p>,</span> <span class=s1>&#39;weight_ew&#39;</span><span class=p>,</span> <span class=s1>&#39;uncertainty_ns&#39;</span><span class=p>,</span> <span class=s1>&#39;weight_ns&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_int_err&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_int_isl_ratio&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_peak_err&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak_isl_ratio&#39;</span><span class=p>,</span> <span class=s1>&#39;forced&#39;</span><span class=p>,</span> <span class=s1>&#39;compactness&#39;</span><span class=p>,</span>
        <span class=s1>&#39;has_siblings&#39;</span><span class=p>,</span> <span class=s1>&#39;snr&#39;</span><span class=p>,</span> <span class=s1>&#39;image&#39;</span><span class=p>,</span> <span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=s1>&#39;source&#39;</span><span class=p>,</span> <span class=s1>&#39;ra&#39;</span><span class=p>,</span> <span class=s1>&#39;dec&#39;</span><span class=p>,</span>
        <span class=s1>&#39;ra_source&#39;</span><span class=p>,</span> <span class=s1>&#39;dec_source&#39;</span><span class=p>,</span> <span class=s1>&#39;d2d&#39;</span><span class=p>,</span> <span class=s1>&#39;dr&#39;</span><span class=p>,</span> <span class=s1>&#39;related&#39;</span><span class=p>,</span> <span class=s1>&#39;epoch&#39;</span><span class=p>,</span>
        <span class=s1>&#39;uncertainty_ew_source&#39;</span><span class=p>,</span> <span class=s1>&#39;uncertainty_ns_source&#39;</span>
    <span class=p>]]</span>

    <span class=c1># Create the unique skyc1_srcs dataframe.</span>
    <span class=n>skyc1_srcs</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=o>~</span><span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;forced&#39;</span><span class=p>]]</span>
        <span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>
        <span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;related&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>
    <span class=p>)</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>deep</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=c1># Get relations into the skyc1_srcs (as we only keep the first instance</span>
    <span class=c1># which does not have the relation information)</span>
    <span class=n>skyc1_srcs</span> <span class=o>=</span> <span class=n>skyc1_srcs</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
        <span class=n>prev_relations</span><span class=p>,</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span> <span class=n>left_on</span><span class=o>=</span><span class=s1>&#39;source&#39;</span><span class=p>,</span> <span class=n>right_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>

    <span class=c1># Need to break the pointer relationship between the related sources (</span>
    <span class=c1># deep=True copy does not truly copy mutable type objects)</span>
    <span class=n>relation_mask</span> <span class=o>=</span> <span class=n>skyc1_srcs</span><span class=o>.</span><span class=n>related</span><span class=o>.</span><span class=n>notna</span><span class=p>()</span>
    <span class=n>relation_vals</span> <span class=o>=</span> <span class=n>skyc1_srcs</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>relation_mask</span><span class=p>,</span> <span class=s1>&#39;related&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>to_list</span><span class=p>()</span>
    <span class=n>new_relation_vals</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>relation_vals</span><span class=p>]</span>
    <span class=n>skyc1_srcs</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>relation_mask</span><span class=p>,</span> <span class=s1>&#39;related&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_relation_vals</span>

    <span class=c1># Reorder so we don&#39;t mess up the dask metas.</span>
    <span class=n>skyc1_srcs</span> <span class=o>=</span> <span class=n>skyc1_srcs</span><span class=p>[[</span>
        <span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;ra&#39;</span><span class=p>,</span> <span class=s1>&#39;uncertainty_ew&#39;</span><span class=p>,</span> <span class=s1>&#39;weight_ew&#39;</span><span class=p>,</span> <span class=s1>&#39;dec&#39;</span><span class=p>,</span> <span class=s1>&#39;uncertainty_ns&#39;</span><span class=p>,</span>
        <span class=s1>&#39;weight_ns&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_int&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_int_err&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_int_isl_ratio&#39;</span><span class=p>,</span>
        <span class=s1>&#39;flux_peak&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak_err&#39;</span><span class=p>,</span> <span class=s1>&#39;flux_peak_isl_ratio&#39;</span><span class=p>,</span> <span class=s1>&#39;forced&#39;</span><span class=p>,</span>
        <span class=s1>&#39;compactness&#39;</span><span class=p>,</span> <span class=s1>&#39;has_siblings&#39;</span><span class=p>,</span> <span class=s1>&#39;snr&#39;</span><span class=p>,</span> <span class=s1>&#39;image&#39;</span><span class=p>,</span> <span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=s1>&#39;source&#39;</span><span class=p>,</span>
        <span class=s1>&#39;ra_source&#39;</span><span class=p>,</span> <span class=s1>&#39;dec_source&#39;</span><span class=p>,</span> <span class=s1>&#39;d2d&#39;</span><span class=p>,</span> <span class=s1>&#39;dr&#39;</span><span class=p>,</span> <span class=s1>&#39;related&#39;</span><span class=p>,</span> <span class=s1>&#39;epoch&#39;</span>
    <span class=p>]]</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=c1># Finally move the source ra and dec back to the sources_df ra and dec</span>
    <span class=c1># columns</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;ra&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;ra_source&#39;</span><span class=p>]</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;dec&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;dec_source&#39;</span><span class=p>]</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;uncertainty_ew&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;uncertainty_ew_source&#39;</span><span class=p>]</span>
    <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;uncertainty_ns&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;uncertainty_ns_source&#39;</span><span class=p>]</span>

    <span class=c1># Drop not needed columns for the sources_df.</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span>
        <span class=s1>&#39;uncertainty_ew_source&#39;</span><span class=p>,</span> <span class=s1>&#39;uncertainty_ns_source&#39;</span>
    <span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>sources_df</span><span class=p>,</span> <span class=n>skyc1_srcs</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.remove_duplicate_measurements class="doc doc-heading"> <code class="highlight language-python"><span class=n>remove_duplicate_measurements</span><span class=p>(</span><span class=n>sources_df</span><span class=p>,</span> <span class=n>dup_lim</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ini_df</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.remove_duplicate_measurements class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Remove perceived duplicate sources from a dataframe of loaded measurements. Duplicates are determined by their separation and whether this distances is within the 'dup_lim'.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>sources_df</code></td> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The loaded measurements from two or more images.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>dup_lim</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="astropy.coordinates.Angle">Angle</span>]</code> </td> <td><p>The separation limit of when a source is considered a duplicate. Defaults to None in which case 2.5 arcsec is used (usual ASKAP pixel size).</p></td> <td> <code>None</code> </td> </tr> <tr> <td><code>ini_df</code></td> <td> <code>bool</code> </td> <td><p>Boolean to indicate whether these sources are part of the initial source list creation for association. If 'True' the source ids are reset ready for the first iteration. Defaults to 'False'.</p></td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>The input sources_df with duplicate sources removed.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>remove_duplicate_measurements</span><span class=p>(</span>
    <span class=n>sources_df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
    <span class=n>dup_lim</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Angle</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>ini_df</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Remove perceived duplicate sources from a dataframe of loaded</span>
<span class=sd>    measurements. Duplicates are determined by their separation and whether</span>
<span class=sd>    this distances is within the &#39;dup_lim&#39;.</span>

<span class=sd>    Args:</span>
<span class=sd>        sources_df:</span>
<span class=sd>            The loaded measurements from two or more images.</span>
<span class=sd>        dup_lim:</span>
<span class=sd>            The separation limit of when a source is considered a duplicate.</span>
<span class=sd>            Defaults to None in which case 2.5 arcsec is used (usual ASKAP</span>
<span class=sd>            pixel size).</span>
<span class=sd>        ini_df:</span>
<span class=sd>            Boolean to indicate whether these sources are part of the initial</span>
<span class=sd>            source list creation for association. If &#39;True&#39; the source ids are</span>
<span class=sd>            reset ready for the first iteration. Defaults to &#39;False&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        The input sources_df with duplicate sources removed.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Cleaning duplicate sources from epoch...&#39;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>dup_lim</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>dup_lim</span> <span class=o>=</span> <span class=n>Angle</span><span class=p>(</span><span class=mf>2.5</span> <span class=o>*</span> <span class=n>u</span><span class=o>.</span><span class=n>arcsec</span><span class=p>)</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
        <span class=s1>&#39;Using duplicate crossmatch radius of </span><span class=si>%.2f</span><span class=s1> arcsec.&#39;</span><span class=p>,</span> <span class=n>dup_lim</span><span class=o>.</span><span class=n>arcsec</span>
    <span class=p>)</span>

    <span class=c1># sort by the distance from the image centre so we know</span>
    <span class=c1># that the first source is always the one to keep</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;dist_from_centre&#39;</span><span class=p>)</span>

    <span class=n>sources_sc</span> <span class=o>=</span> <span class=n>SkyCoord</span><span class=p>(</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;ra&#39;</span><span class=p>],</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;dec&#39;</span><span class=p>],</span>
        <span class=n>unit</span><span class=o>=</span><span class=p>(</span><span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>,</span> <span class=n>u</span><span class=o>.</span><span class=n>deg</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=c1># perform search around sky to get all self matches</span>
    <span class=n>idxc</span><span class=p>,</span> <span class=n>idxcatalog</span><span class=p>,</span> <span class=o>*</span><span class=n>_</span> <span class=o>=</span> <span class=n>sources_sc</span><span class=o>.</span><span class=n>search_around_sky</span><span class=p>(</span>
        <span class=n>sources_sc</span><span class=p>,</span> <span class=n>dup_lim</span>
    <span class=p>)</span>

    <span class=c1># create df from results</span>
    <span class=n>results</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
        <span class=n>data</span><span class=o>=</span><span class=p>{</span>
            <span class=s1>&#39;source_id&#39;</span><span class=p>:</span> <span class=n>idxc</span><span class=p>,</span>
            <span class=s1>&#39;match_id&#39;</span><span class=p>:</span> <span class=n>idxcatalog</span><span class=p>,</span>
            <span class=s1>&#39;source_image&#39;</span><span class=p>:</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>idxc</span><span class=p>][</span><span class=s1>&#39;image&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>(),</span>
            <span class=s1>&#39;match_image&#39;</span><span class=p>:</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>idxcatalog</span><span class=p>][</span><span class=s1>&#39;image&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=c1># Drop those that are matched from the same image</span>
    <span class=n>matching_image_mask</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>results</span><span class=p>[</span><span class=s1>&#39;source_image&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=n>results</span><span class=p>[</span><span class=s1>&#39;match_image&#39;</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=n>results</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>results</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>matching_image_mask</span><span class=p>]</span>
        <span class=o>.</span><span class=n>drop</span><span class=p>([</span><span class=s1>&#39;source_image&#39;</span><span class=p>,</span> <span class=s1>&#39;match_image&#39;</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=c1># create a pair column defining each pair ith index</span>
    <span class=n>results</span><span class=p>[</span><span class=s1>&#39;pair&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=nb>tuple</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=nb>sorted</span><span class=p>)</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=nb>tuple</span><span class=p>)</span>
    <span class=c1># Drop the duplicate pairs (pairs are sorted so this works)</span>
    <span class=n>results</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>(</span><span class=s1>&#39;pair&#39;</span><span class=p>)</span>
    <span class=c1># No longer need pair</span>
    <span class=n>results</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;pair&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=c1># Drop all self matches and we are left with those to drop</span>
    <span class=c1># in the match id column.</span>
    <span class=n>to_drop</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span>
        <span class=n>results</span><span class=p>[</span><span class=s1>&#39;source_id&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=n>results</span><span class=p>[</span><span class=s1>&#39;match_id&#39;</span><span class=p>],</span>
        <span class=s1>&#39;match_id&#39;</span>
    <span class=p>]</span>
    <span class=c1># Get the index values from the ith values</span>
    <span class=n>to_drop_indexes</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>to_drop</span><span class=p>]</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>values</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
        <span class=s2>&quot;Dropping </span><span class=si>%i</span><span class=s2> duplicate measurements.&quot;</span><span class=p>,</span> <span class=n>to_drop_indexes</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=c1># Drop them from sources</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>to_drop_indexes</span><span class=p>)</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;ra&#39;</span><span class=p>)</span>

    <span class=c1># reset the source_df index</span>
    <span class=n>sources_df</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=c1># Reset the source number</span>
    <span class=k>if</span> <span class=n>ini_df</span><span class=p>:</span>
        <span class=n>sources_df</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sources_df</span><span class=o>.</span><span class=n>index</span> <span class=o>+</span> <span class=mi>1</span>

    <span class=k>del</span> <span class=n>results</span>

    <span class=k>return</span> <span class=n>sources_df</span>
</code></pre></div> </td></tr></table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=vast_pipeline.pipeline.utils.write_parquets class="doc doc-heading"> <code class="highlight language-python"><span class=n>write_parquets</span><span class=p>(</span><span class=n>images</span><span class=p>,</span> <span class=n>skyregions</span><span class=p>,</span> <span class=n>bands</span><span class=p>,</span> <span class=n>run_path</span><span class=p>)</span></code> <a href=#vast_pipeline.pipeline.utils.write_parquets class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>This function saves images, skyregions and bands to parquet files. It also returns a DataFrame containing containing the information of the sky regions associated with the current run.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>images</code></td> <td> <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="vast_pipeline.models.Image" href="../../models/#vast_pipeline.models.Image">Image</a>]</code> </td> <td><p>list of image Django ORM objects.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>skyregions</code></td> <td> <code><span title="typing.List">List</span>[<span title="vast_pipeline.models.SkyRegion">SkyRegion</span>]</code> </td> <td><p>list sky region Django ORM objects.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>bands</code></td> <td> <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="vast_pipeline.models.Band" href="../../models/#vast_pipeline.models.Band">Band</a>]</code> </td> <td><p>list of band Django ORM objects.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>run_path</code></td> <td> <code>str</code> </td> <td><p>directory to save parquets to.</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code> </td> <td><p>Sky regions as pandas DataFrame.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>vast_pipeline/pipeline/utils.py</code></summary> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1667</span>
<span class=normal>1668</span>
<span class=normal>1669</span>
<span class=normal>1670</span>
<span class=normal>1671</span>
<span class=normal>1672</span>
<span class=normal>1673</span>
<span class=normal>1674</span>
<span class=normal>1675</span>
<span class=normal>1676</span>
<span class=normal>1677</span>
<span class=normal>1678</span>
<span class=normal>1679</span>
<span class=normal>1680</span>
<span class=normal>1681</span>
<span class=normal>1682</span>
<span class=normal>1683</span>
<span class=normal>1684</span>
<span class=normal>1685</span>
<span class=normal>1686</span>
<span class=normal>1687</span>
<span class=normal>1688</span>
<span class=normal>1689</span>
<span class=normal>1690</span>
<span class=normal>1691</span>
<span class=normal>1692</span>
<span class=normal>1693</span>
<span class=normal>1694</span>
<span class=normal>1695</span>
<span class=normal>1696</span>
<span class=normal>1697</span>
<span class=normal>1698</span>
<span class=normal>1699</span>
<span class=normal>1700</span>
<span class=normal>1701</span>
<span class=normal>1702</span>
<span class=normal>1703</span>
<span class=normal>1704</span>
<span class=normal>1705</span>
<span class=normal>1706</span>
<span class=normal>1707</span>
<span class=normal>1708</span>
<span class=normal>1709</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>write_parquets</span><span class=p>(</span>
    <span class=n>images</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Image</span><span class=p>],</span>
    <span class=n>skyregions</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>SkyRegion</span><span class=p>],</span>
    <span class=n>bands</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Band</span><span class=p>],</span>
    <span class=n>run_path</span><span class=p>:</span> <span class=nb>str</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    This function saves images, skyregions and bands to parquet files.</span>
<span class=sd>    It also returns a DataFrame containing containing the information</span>
<span class=sd>    of the sky regions associated with the current run.</span>

<span class=sd>    Args:</span>
<span class=sd>        images: list of image Django ORM objects.</span>
<span class=sd>        skyregions: list sky region Django ORM objects.</span>
<span class=sd>        bands: list of band Django ORM objects.</span>
<span class=sd>        run_path: directory to save parquets to.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Sky regions as pandas DataFrame.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># write images parquet file under pipeline run folder</span>
    <span class=n>images_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>,</span> <span class=n>images</span><span class=p>))</span>
    <span class=n>images_df</span> <span class=o>=</span> <span class=n>images_df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;_state&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>images_df</span><span class=o>.</span><span class=n>to_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>run_path</span><span class=p>,</span> <span class=s1>&#39;images.parquet&#39;</span><span class=p>),</span>
        <span class=n>index</span><span class=o>=</span><span class=kc>False</span>
    <span class=p>)</span>
    <span class=c1># write skyregions parquet file under pipeline run folder</span>
    <span class=n>skyregs_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>,</span> <span class=n>skyregions</span><span class=p>))</span>
    <span class=n>skyregs_df</span> <span class=o>=</span> <span class=n>skyregs_df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;_state&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>skyregs_df</span><span class=o>.</span><span class=n>to_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>run_path</span><span class=p>,</span> <span class=s1>&#39;skyregions.parquet&#39;</span><span class=p>),</span>
        <span class=n>index</span><span class=o>=</span><span class=kc>False</span>
    <span class=p>)</span>
    <span class=c1># write skyregions parquet file under pipeline run folder</span>
    <span class=n>bands_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>,</span> <span class=n>bands</span><span class=p>))</span>
    <span class=n>bands_df</span> <span class=o>=</span> <span class=n>bands_df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;_state&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>bands_df</span><span class=o>.</span><span class=n>to_parquet</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>run_path</span><span class=p>,</span> <span class=s1>&#39;bands.parquet&#39;</span><span class=p>),</span>
        <span class=n>index</span><span class=o>=</span><span class=kc>False</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>skyregs_df</span>
</code></pre></div> </td></tr></table> </details> </div> </div> </div> </div> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">April 26, 2022</span> <br> Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">April 26, 2022</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../pairs/ class="md-footer__link md-footer__link--prev" aria-label="Previous: pairs.py" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> pairs.py </div> </div> </a> <a href=../../survey/translators/ class="md-footer__link md-footer__link--next" aria-label="Next: translators.py" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> translators.py </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2020 - 2025 Vast Development Team, University of Sydney - all right reserved </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/askap-vast/vast-pipeline target=_blank rel=noopener title="vast-pipeline source on GitHub" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://vast-survey.org target=_blank rel=noopener title=vast-survey.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.3c-2.1-20.4-4.2-41.8-4.2-64 0-22.2 2.1-43.6 4.2-64h185.4c2.1 20.4 3.3 41.8 3.3 64zm151.9-64c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42.9 3.2-64 0-22-1.1-43.4-3.2-64h123.1zm-10.5-32H376.7c-10-63.86-29.8-117.38-55.3-151.558C399.8 29.09 463.4 85.94 493.4 160zm-149.1 0H167.7c6.1-36.4 15.5-68.62 27-94.65 10.5-23.61 22.2-40.74 33.5-51.54C239.4 3.178 248.7 0 256 0c7.3 0 16.6 3.178 27.8 13.81 11.3 10.8 23 27.93 33.5 51.54 11.5 26.03 20.9 58.25 27 94.65zm-325.69 0C48.59 85.94 112.2 29.09 190.6 8.442 165.1 42.62 145.3 96.14 135.3 160H18.61zm112.59 32c-2.1 20.6-4.1 42-4.1 64 0 21.1 2 43.4 4.1 64H8.065C2.8 299.5 0 278.1 0 256s2.8-43.5 8.065-64H131.2zm63.5 254.6c-11.5-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.7-22.2 40.8-33.5 51.6-11.2 10.6-20.5 13.8-28.7 13.8-6.4 0-15.7-3.2-26.9-13.8-11.3-10.8-23-27.9-33.5-51.6zm-4.1 57C112.2 482.9 48.59 426.1 18.61 352H135.3c10 63.9 29.8 117.4 55.3 151.6zm130.8 0c25.5-34.2 45.3-87.7 55.3-151.6h116.7c-30 74.1-93.6 130.9-172 151.6z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.sections"], "search": "../../../assets/javascripts/workers/search.5e67fbfe.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.c44cc438.min.js></script> <script src=../../../theme/js/extra.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>